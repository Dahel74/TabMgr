var $m=go.GraphObject.make;function JSLibInitExtendFamilyTree(ajaxController){var mInitialGroupFilters,mAjaxController=ajaxController,mtemplateMaker=null,mlayoutBuilder=null,moldScale=0,showOverview=null,mLayoutParameters={caseHeight:270,caseCentralHeight:190,descendantSpouseCaseHeight:220,caseWidth:150,centralCaseWidth:400,groupSpace:40,unionSpace:20,siblingSpace:20,layerSpace:50,linkStrokeWidth:3,GetUnionHeight:function(){return(this.caseHeight-this.descendantSpouseCaseHeight)/2+this.descendantSpouseCaseHeight}},mDiagram=null,mNodeDataArray=[],mLinkDataArray=[],mApiNodeList={},mApiIndividusList={},mApiUnionsList={},mCentralId=null,mCentralKey=void 0;this.initTree=function(containerId,centralId,groupFilters,showPreview){go.licenseKey="73fe43e4b21c28c702d95d76423d6cbc5cf07f21de821da0585110a7ea5c6e167598e12a01d68ac9d7fc4dee0a7b978989c53e7a941b0539e53084d547e3d3f0e63375b417084f89f60126909dfc23f6ac7b79f4c3bd27f7da7d8ba1e8a8c09d5feda08441d81ebd7c280031042eae58a7f8d87bff1dc8506b6a",mCentralId=Number(centralId),mInitialGroupFilters=groupFilters,showOverview=showPreview;var scale=getDiagramScale();mDiagram=$m(go.Diagram,containerId,{"animationManager.isEnabled":!1,"toolManager.mouseWheelBehavior":go.ToolManager.WheelZoom,"toolManager.hoverDelay":500,hasHorizontalScrollbar:!1,hasVerticalScrollbar:!1,isReadOnly:!0,scale:Number(scale),initialContentAlignment:go.Spot.Center,maxScale:2.72,minScale:.15,padding:50,autoScale:go.Diagram.None,allowSelect:!1})};var mImageDataUrlCache=new ImageDataUrlCache(mAjaxController),mImagesToLoad={"SilhouetteFemme.png":"./Common/Resources/iconSexeFE/SilhouetteFemme.png","SilhouetteHomme.png":"./Common/Resources/iconSexeFE/SilhouetteHomme.png","SilhouetteIndetermine.png":"./Common/Resources/iconSexeFE/SilhouetteIndetermine.png","ico-sex-ind-sosa.png":"./Common/Resources/sexe/iconFe/ico-sex-ind-sosa.png","ico-sex-fem-sosa.png":"./Common/Resources/sexe/iconFe/ico-sex-fem-sosa.png","ico-sex-hom-sosa.png":"./Common/Resources/sexe/iconFe/ico-sex-hom-sosa.png","ico-sex-ind.png":"./Common/Resources/sexe/iconFe/ico-sex-ind.png","ico-sex-fem.png":"./Common/Resources/sexe/iconFe/ico-sex-fem.png","ico-sex-hom.png":"./Common/Resources/sexe/iconFe/ico-sex-hom.png"},completeNodeDataArray=function(){var defaultIconSexe={102:"SilhouetteFemme.png",109:"SilhouetteHomme.png",63:"SilhouetteIndetermine.png"};mNodeDataArray.forEach(function(nodeData){var codeId=nodeData.codeId,key=nodeData.key,nodeApiData=mApiNodeList[codeId];if(void 0!==nodeApiData&&"union"!==nodeApiData.type){if("fakeIndividu"===nodeApiData.type){if("fakeSpouse"===nodeApiData.category){nodeData.category="descendantSpouse",nodeData.noms=nodeApiData.nom,nodeData.isMajor=!1,nodeData.hasMedia="none",nodeData.isFake=!0;var spouseFromId=nodeApiData.spouseFrom,spouseData=mApiIndividusList[spouseFromId];return nodeData.noms=TRANSLATER.get("HNLOC_EXTENDEDFAMILY_UNKNOWN_SPOUSE_MALE"),nodeData.sexe=63,void 0!==spouseData&&(102===spouseData.sexe?nodeData.sexe=109:109===spouseData.sexe&&(nodeData.sexe=102,nodeData.noms=TRANSLATER.get("HNLOC_EXTENDEDFAMILY_UNKNOWN_SPOUSE_FEMALE"))),void(nodeData.mediaSource=mImageDataUrlCache.get(defaultIconSexe[nodeData.sexe]))}return nodeApiData.isMain?nodeData.category="fakeCentral":nodeApiData.isMajor&&(nodeData.category="fakeMajor"),nodeData.sosaPosition=nodeApiData.sosaPosition,void(nodeData.codeChildFrom=nodeApiData.codeChildFrom)}if("fakeUnion"!==nodeApiData.type){nodeApiData.isMain&&void 0===mCentralKey&&(mCentralKey=key);var data=mApiIndividusList[codeId];if(nodeData.noms=data.strNom,nodeData.prenoms=data.strPrenomsTous,nodeData.profession=data.strProfessionTitre,nodeData.dateDecesDigital=data.strDateDecesfdP_08_02_1954,nodeData.dateDecesDigitalAndAge=data.strDateDecesfdP_08_02_1954,nodeData.dateDecesLettreAndAge=data.strDateDecesfd_lun_8_fev_1954,""!==data.strAgeDeces&&(nodeData.dateDecesDigitalAndAge+=" ("+data.strAgeDeces+")",nodeData.dateDecesLettreAndAge+=" ("+data.strAgeDeces+")"),nodeData.dateNaissanceDigital=data.strDateNaissancefdP_08_02_1954,nodeData.dateDecesLettre=data.strDateDecesfd_lun_8_fev_1954,nodeData.dateNaissanceLettre=data.strDateNaissancefd_lun_8_fev_1954,nodeData.codeLieuDeces=data.strLieuDecesCodeLieuAbrege,nodeData.dptDeces=data.strLieuDecesDepartement,nodeData.villeDeces=data.strLieuDecesVille,nodeData.codeLieuNaissance=data.strLieuNaissanceCodeLieuAbrege,nodeData.dptNaissance=data.strLieuNaissanceDepartement,nodeData.prenom=data.strPrenomUsuel,nodeData.prenomsTous=data.strPrenomsTous,nodeData.dateNDCourte=data.strNaisDecesCourtWithPrivate,nodeData.lieuNaissanceAbrege=data.strLieuNaissanceVilleCodeAbrege,nodeData.lieuDecesAbrege=data.strLieuDecesVilleCodeAbrege,nodeData.lieuNaissanceComplet=data.strLieuNaissanceDynamiqueSubdivision,nodeData.lieuDecesComplet=data.strLieuDecesDynamiqueSubdivision,nodeData.sexeEnumId=data.sexe,nodeData.LieuDecesDept=data.strLieuDecesDepartement,nodeData.LieuDecesSubdivision=data.subdivisionDeces,nodeData.LieuDeces=data.strLieuDecesDynamique,nodeData.lieuNaissanceDept=data.strLieuNaissanceDepartement,nodeData.lieuNaissanceSubdivision=data.subdivisionNaissance,nodeData.lieuNaissance=data.strLieuNaissanceDynamique,nodeData.isSosa=data.isSosa,nodeData.sosaString=data.sosa,nodeData.sexe=data.sexe,nodeData.alive=data.indiSupposeEnVie,nodeData.PCALiveAge=TRANSLATER.get("HNLOC_EXTENDEDFAMILY_CASE_PC_AGE")+data.strAge,nodeApiData.isMain&&mCentralKey===key)nodeData.category="main",nodeData.strPrenomsSurnom=data.strPrenomsSurnom;else if(nodeApiData.isMajor?nodeData.isMajor=nodeApiData.isMajor:nodeData.isMajor=!1,nodeData.isAscendant&&"descendantSpouse"!==nodeData.type){var unionFromCodeId;if(void 0!==(unionFromCodeId=nodeData.unionCodeIdFrom)){var unionData=mApiUnionsList[unionFromCodeId];void 0!==mApiUnionsList[unionFromCodeId]?(nodeData.dateMariageDigital=unionData.strDateMariagefdP_08_02_1954,nodeData.lieuMariageComplet=unionData.strLieuMariageDynamique,nodeData.dateMariageComplet=unionData.strDateMariagefd_lun_8_fev_1954):(nodeData.dateMariageDigital="",nodeData.lieuMariageComplet="",nodeData.dateMariageComplet="")}nodeData.category="ascendancy"}else nodeData.category="descendancy";if("descendantSpouse"===nodeData.type)if(nodeData.category="descendantSpouse",void 0!==(unionFromCodeId=nodeData.unionCodeIdFrom)){unionData=mApiUnionsList[unionFromCodeId];nodeData.dateMariageDigital=unionData.strDateMariagefdP_08_02_1954,nodeData.lieuMariageComplet=unionData.strLieuMariageDynamique,nodeData.dateMariageComplet=unionData.strDateMariagefd_lun_8_fev_1954}nodeData.hasMedia="",void 0!==data.firstMediaID&&0!==data.firstMediaID&&""!==data.firstMediaData?(nodeData.mediaSource="data: image/png;base64,"+data.firstMediaData,nodeData.hasMedia="hasMedia"):(nodeData.mediaSource=mImageDataUrlCache.get(defaultIconSexe[data.sexe]),nodeData.hasMedia="none")}}},this)},GroupFilterToFilterType={1:LayoutBuilder.FilterType.GREATGRANDPARENTS,2:LayoutBuilder.FilterType.SIBLINGS,3:LayoutBuilder.FilterType.GRANDCHILDREN,4:LayoutBuilder.FilterType.COUSINS,5:LayoutBuilder.FilterType.STEPPARENTS,6:LayoutBuilder.FilterType.STEPCHILDREN},setFilterGroup=function(filterGroupString){var newFilters=[];void 0===filterGroupString&&(filterGroupString=""),filterGroupString.split(",").forEach(function(filterGroup){var filterType=GroupFilterToFilterType[filterGroup];void 0!==filterType&&newFilters.push(filterType)}),mlayoutBuilder.setFilters(newFilters)};this.applyFilters=function(newFilters){setFilterGroup(newFilters),rebuildDiagram()},this.changeCentral=function(individuId){buildWithCentral(individuId)};var buildWithCentral=function(individuId){mAjaxController.getNodelist(individuId,function(data){var apiData;mCentralId=individuId,mApiNodeList=(apiData=data).nodeList,mApiIndividusList=apiData.individuList,mApiUnionsList=apiData.unionList,mlayoutBuilder.setDataManager(mApiNodeList),setupDiagram()},this)};this.drawTree=function(){mAjaxController.getCurrentTheme(function(data){$("#myOverview").show(),mImagesToLoad["alliances.png"]="./"+data.themeDirectoryRelativePath+"/alliances.png";var buttonZoomPadding=(mDiagram.maxScale-mDiagram.minScale)/20;$("#iconButtonPlus").kendoButton({imageUrl:"../../Common/Resources/MediaAdd.png",click:function(e){mDiagram.scale+=buttonZoomPadding}}).attr("title",TRANSLATER.get("HNLOC_EXTENDEDFAMILY_ZOOM_IN_TOOLTIP")),$("#iconButtonPlus").attr("title",TRANSLATER.get("HNLOC_EXTENDEDFAMILY_ZOOM_IN_TOOLTIP")),$("#iconButtonPlus > img").height(14).width(14),$("#iconButtonMinus").kendoButton({imageUrl:"../../Common/Resources/MediaDelete.png",click:function(e){mDiagram.scale-=buttonZoomPadding}}),$("#iconButtonMinus").attr("title",TRANSLATER.get("HNLOC_EXTENDEDFAMILY_ZOOM_OUT_TOOLTIP")),$("#iconButtonMinus > img").height(14).width(14),$.when(mImageDataUrlCache.load(mImagesToLoad)).done(function(){mtemplateMaker=new TemplateMaker($m,mDiagram,mLayoutParameters,mImageDataUrlCache,mAjaxController,!0),mlayoutBuilder=new LayoutBuilder(mLayoutParameters),setFilterGroup(mInitialGroupFilters),mtemplateMaker.setObjectTheme(data),mtemplateMaker.setDebugMode(!1),mtemplateMaker.applyTemplate(),buildWithCentral(mCentralId),addListeners()})})};var mPrinter=void 0;this.drawPrintPreviewTree=function(){mImagesToLoad["alliances.png"]="./Common/Resources/alliances.png",$.when(mImageDataUrlCache.load(mImagesToLoad)).done(function(){mPrinter=new DiagramPrinter(mAjaxController,mDiagram),mtemplateMaker=new TemplateMaker($m,mDiagram,mLayoutParameters,mImageDataUrlCache,mAjaxController,!1),mlayoutBuilder=new LayoutBuilder(mLayoutParameters),setFilterGroup(mInitialGroupFilters),mlayoutBuilder.setPrintMode(!0),mtemplateMaker.setObjectTheme({borderRadius:0,colors:{AddIndividuTextColor:"rgba(66, 66, 66, 1.000000)",AddIndividuTextOverColor:"rgba(84, 152, 220, 1.000000)",AscendanceCouleurFemme:"rgba(198, 229, 93, 1.000000)",AscendanceCouleurHomme:"rgba(152, 203, 4, 1.000000)",AscendanceCouleurInconnu:"rgba(235, 227, 87, 1.000000)",AscendanceCouleurtrait1:"rgba(152, 194, 29, 1.000000)",AscendanceCouleurtrait2:"rgba(166, 212, 32, 1.000000)",AscendanceCouleurtrait3:"rgba(177, 225, 36, 1.000000)",AscendanceCouleurtrait4:"rgba(186, 237, 37, 1.000000)",Background:"rgba(255, 255, 255, 1.000000)",ButtonTextColor:"rgba(55, 55, 55, 1.000000)",couleurBoutonSousOngletContour:"rgba(127, 127, 127, 1.000000)",couleurBoutonSousOngletFond:"rgba(230, 230, 230, 1.000000)",couleurCaseSurvol:"rgba(233, 233, 233, 1.000000)",FondBandeauIdentite:"rgba(245, 245, 245, 1.000000)",FondBandeauMulticritere:"rgba(255, 255, 255, 1.000000)",FondBandeauTitre:"rgba(255, 255, 255, 1.000000)",FondOnglet:"rgba(255, 255, 255, 1.000000)",MainBackgroundColor:"rgba(235, 235, 235, 1.000000)",MainBorderColor:"rgba(210, 210, 210, 1.000000)",MainFakePersonBackgroundColor:"rgba(230, 230, 230, 1.000000)",MainFakePersonBorderColor:"rgba(230, 230, 230, 1.000000)",MainMediaBackgroundColor:"rgba(233, 233, 233, 1.000000)",MainTextColor1:"rgba(32, 32, 32, 1.000000)",MainTextColor2:"rgba(108, 108, 108, 1.000000)",MajorBackgroundColor:"rgba(235, 235, 235, 1.000000)",MajorBorderColor:"rgba(176, 178, 181, 1.000000)",MajorLinkColor:"rgba(47, 124, 213, 1.000000)",MajorMediaBackgroundColor:"rgba(176, 178, 181, 1.000000)",MajorTextColor1:"rgba(32, 32, 32, 1.000000)",MajorTextColor2:"rgba(108, 108, 108, 1.000000)",MinorBackgroundColor:"rgba(210, 210, 210, 1.000000)",MinorBorderColor:"rgba(176, 178, 181, 1.000000)",MinorLinkColor:"rgba(115, 115, 115, 1.000000)",MinorMediaBackgroundColor:"rgba(233, 233, 233, 1.000000)",MinorTextColor1:"rgba(32, 32, 32, 1.000000)",MinorTextColor2:"rgba(86, 91, 96, 1.000000)",OngletTexte:"rgba(55, 55, 55, 1.000000)",OngletTexteActif:"rgba(55, 55, 55, 1.000000)",OngletTexteSurvol:"rgba(32, 32, 32, 1.000000)",SelectedBorderColor:"rgba(108, 176, 255, 1.000000)",SeparatorBorderColor:"rgba(176, 178, 181, 1.000000)",SpouseFETextColor1:"rgba(230, 230, 230, 1.000000)",SpouseTextColor1:"rgba(230, 230, 230, 1.000000)",TexteBandeauIdentite:"rgba(32, 32, 32, 1.000000)",TexteBandeauIdentiteExt:"rgba(108, 108, 108, 1.000000)",TexteBandeauTitre:"rgba(66, 66, 66, 1.000000)"},fontFamilly:"arial",linkRadius:0,themeDirectoryRelativePath:""}),mtemplateMaker.applyTemplate(),buildWithCentral(mCentralId),mDiagram.addDiagramListener("InitialLayoutCompleted",function(e){mPrinter.OnLayoutCompleted(mCentralKey)})})},this.generateImages=function(){mPrinter.generateImages()},this.exportPDF=function(){mPrinter.printToPdf()};var addListeners=function(){mDiagram.addDiagramListener("ObjectSingleClicked",function(e){var part=e.subject.part;part instanceof go.Link||("fakeCentral"===part.category?mAjaxController.addNewIndividu():"fakeMajor"===part.category?mAjaxController.addNewParent(part.data.codeChildFrom,part.data.sosaPosition%2==0?"father":"mother"):resumeIndividu(mAjaxController.uuid,mAjaxController.port,part.data.codeId))}),mDiagram.addDiagramListener("InitialLayoutCompleted",function(e){var node=mDiagram.findNodeForKey(mCentralKey);null!==node&&(mDiagram.centerRect(node.actualBounds),mDiagram.rebuildParts())}),mDiagram.addDiagramListener("ViewportBoundsChanged",function(e){getViewForScale(mDiagram.scale)}),mDiagram.addDiagramListener("BackgroundContextClicked",function(e){}),mDiagram.addDiagramListener("ObjectDoubleClicked",function(e){e.subject.part instanceof go.Node&&mAjaxController.navigSaisieIndi(e.subject.part.data.codeId)})},getViewForScale=function(scale){moldScale>.45&&scale<.45?mtemplateMaker.getTemplateForZoom(1,function(){mDiagram.rebuildParts()}):moldScale<.45&&scale>.45?mtemplateMaker.getTemplateForZoom(2,function(){mDiagram.rebuildParts()}):moldScale>1.1&&scale<1.1?mtemplateMaker.getTemplateForZoom(2,function(){mDiagram.rebuildParts()}):moldScale<1.1&&scale>1.1?mtemplateMaker.getTemplateForZoom(3,function(){mDiagram.rebuildParts()}):moldScale>1.58&&scale<1.58?mtemplateMaker.getTemplateForZoom(3,function(){mDiagram.rebuildParts()}):moldScale<1.58&&scale>1.58&&mtemplateMaker.getTemplateForZoom(4,function(){mDiagram.rebuildParts()}),moldScale=scale,setDiagramScale(mDiagram.scale)},mIsInstalled=!1,setupDiagram=function(){mIsInstalled?rebuildDiagram():(mlayoutBuilder.build(mCentralId,mNodeDataArray,mLinkDataArray),initViewForScale(void 0!==mPrinter?mPrinter.getmDiagramOriginalScale():mDiagram.scale),completeNodeDataArray(),mDiagram.model=$m(go.GraphLinksModel,{linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:mNodeDataArray,linkDataArray:mLinkDataArray}),$m(go.Overview,"myOverview",{observed:mDiagram,autoScale:go.Diagram.Uniform,contentAlignment:go.Spot.Center}),mIsInstalled=!0,"1"===showOverview?$("#myOverview").show():$("#myOverview").hide())},rebuildDiagram=function(){mNodeDataArray=[],mLinkDataArray=[],mCentralKey=void 0,mlayoutBuilder.build(mCentralId,mNodeDataArray,mLinkDataArray),completeNodeDataArray(),mDiagram.clear(),$("#menu").hide(),mDiagram.model.nodeDataArray=mNodeDataArray,mDiagram.model.linkDataArray=mLinkDataArray},initViewForScale=function(scale){moldScale=scale,scale<=.45?mtemplateMaker.getTemplateForZoom(1):scale>.45&&scale<=1.1?mtemplateMaker.getTemplateForZoom(2):scale>1.1&&scale<=1.58?mtemplateMaker.getTemplateForZoom(3):scale>1.58&&mtemplateMaker.getTemplateForZoom(4)},setDiagramScale=function(scale){$.cookie("scale",scale,{expires:365})},getDiagramScale=function(){if(void 0!==$.cookie("scale"))return $.cookie("scale");return $.cookie("scale",1,{expires:365}),1}}