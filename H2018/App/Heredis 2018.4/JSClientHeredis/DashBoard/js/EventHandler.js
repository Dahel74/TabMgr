function EventHandler(){var notification,controller,self=this,dragAndDrop=new DragAndDrop,printWidget=new Print,zoom=!1,widgetsToAddToHomepage=[],init=!1;this.init=function(context){controller=context,init||($("#updateCache").click(function(){controller.resetCacheDatas(function(){controller.uploadCache("paramsDhb"),controller.setCurrentPortee(controller.getCurrentPortee())})}),init=!0),printWidget.init(controller),dragAndDrop.init("WidgetContainer",context),notification=$("#notification").kendoNotification({position:{top:"5%"}}).data("kendoNotification"),"accueil"===controller.getPage()?(self.showCloseButton(),dragAndDrop.getWindowAllWidgets("WidgetContainer",function(){$("#fantome").click(function(){widgetsToAddToHomepage=[],controller.getAllWidgets(function(){$("#container ul li:not(.sectionHeader)").css("cursor","pointer"),$(".bigWidget").css("width","755px"),$("#container ul li:not(.sectionHeader)").click(function(event){if("1"===$(this).css("opacity"))$(this).css("opacity",".6"),$(this).css("background-color","grey"),widgetsToAddToHomepage.push([$(this).data("page"),$(this).data("index")]);else{$(this).css("opacity","1"),$(this).css("background-color","white");var index=widgetsToAddToHomepage.indexOf([$(this).data("page"),$(this).data("index"),$(this).data("type")]);widgetsToAddToHomepage.splice(index,1)}}),$("#ajouter").click(function(){0!==widgetsToAddToHomepage.length?(controller.addWidgetsToHomepage(widgetsToAddToHomepage),$("#allWidgets").data("kendoWindow").close(),controller.refresh()):notification.show(localisedString.HNLOC_DASH_CHOIX_WIDGET_LABEL),widgetsToAddToHomepage=[]})})})})):self.hideCloseButton(),$("#option").click(function(){controller.initOptions(function(currPortee,currPeriode){$("#filtreIndi").data("kendoDropDownList").text(currPortee),$("#filtrePeriode").data("kendoDropDownList").text(currPeriode),$("#filtreIndi").data("kendoDropDownList").refresh(),$("#filtrePeriode").data("kendoDropDownList").text(controller.getPeriodeIntitule()),$("#filtrePeriode").change(function(){$("option:selected",this).attr("selected","selected"),$("option:not(:selected)",".periode").removeAttr("selected")}),$("#filtreIndi").change(function(){$("option:selected",this).attr("selected","selected"),$("option:not(:selected)",".filtreIndi").removeAttr("selected")}),$("#options").find(".valider").click(function(){controller.setCurrentPeriode($("option:selected",$("#filtrePeriode")).val()),controller.setCurrentPortee($("option:selected",$("#filtreIndi")).val()),$("#options").data("kendoWindow").close()}),$("#options").find(".resetCookies").click(function(){controller.emptyCache(),controller.setCurrentPortee(localisedString.HNLOC_DASH_FILTRE_ALL),controller.setCurrentPeriode(localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE),$("#options").data("kendoWindow").close()})})}),$(".closeButton").click(function(event){var context;context=$(event.target).is("img")?event.target.parentElement.parentElement.parentElement.parentElement.parentElement:event.target.parentElement.parentElement.parentElement.parentElement;var pos=$(context).index();$(context).remove(),controller.removeWidgetAtIndex(pos);var str=localisedString.HNLOC_DASH_FAVORIS_OFF;notification.show(str.replace("%s",$(context).find(".entete span").html()))}),$(".fullScreen").click(function(event){var lien,currLi="",currWidget="";$(event.target).is("button")?("undefined"!==$(this).data("rep")&&(lien=$(this).data("rep")),currLi=event.target.parentElement.parentElement.parentElement,currWidget=event.target.parentElement.parentElement):(currLi=event.target.parentElement.parentElement.parentElement.parentElement.parentElement,currWidget=event.target.parentElement.parentElement.parentElement.parentElement),getDetail(event,currLi,currWidget,lien)}),$(".addToHomePage").click(function(event){var item;if(item=$(event.target).is("img")?event.target.parentElement.parentElement.parentElement.parentElement.parentElement:event.target.parentElement.parentElement.parentElement.parentElement,"true"===$(item).data("favoris")){$(item).find(".addToHomePage").attr("title",localisedString.HNLOC_DASH_TOOLTIP_FAVORIS),$(item).find(".addToHomePage > img").attr("src","../Common/Resources//icon/favoris_off.png"),controller.removeWidgetFromHomePage([controller.getPage(),$(item).index()],$(item).data("type")),$(item).data("favoris","false");var str=localisedString.HNLOC_DASH_FAVORIS_OFF;notification.show(str.replace("%s",$(item).find(".entete span").html()))}else{$(item).find(".addToHomePage").attr("title",localisedString.HNLOC_DASH_BOUTON_FERMER),$(item).find(".addToHomePage > img").attr("src","../Common/Resources/icon/favoris_on.png"),controller.addWidgetsToHomepage([[controller.getPage(),$(item).index()]]),$(item).data("favoris","true");str=localisedString.HNLOC_DASH_FAVORIS_ON;notification.show(str.replace("%s",$(item).find(".entete span").html()))}})},this.initGraphOptionSelectAction=function(index,context){$(context).find(".valider").click(function(){controller.getVueDetailleWidget(index,context,function(){},$("option:selected",$(".formatValues")).val(),$("option:selected",$(".padValues")).val(),$("option:selected",$(".sexeValues")).val())})};var getDetail=function(evt,li,widget,lien){!1===zoom?(zoom=!0,$(".contenu").css("margin-bottom","30px"),$(li).toggleClass("detail"),$(li).find(".details").html(localisedString.HNLOC_DASH_BUTTON_BACK_LABEL),$(li).find(".footer .pdf").remove(),$(li).find(".contenu").css({"text-align":"center"}),$(".stats > div").css({display:"inline-block","min-width":"200px"}),$(li).css({width:"99%",height:"100%"}),$(".categorie li").each(function(){$(this).is(li)||$(this).remove()}),$(widget).data("typeW","detaille"),"undefined"!==lien&&$(widget).data("lien",lien),controller.getVueDetailleWidget($(widget).data("index"),widget,function(){self.initGraphOptionSelectAction($(widget).data("index"),widget)}),$(li).find(".closeButton").css("display","none")):(zoom=!1,$(widget).data("typeW","simple"),controller.refresh())};this.responsive=function(){$(window).resize(function(){window.matchMedia("(max-width:987px)").matches?zoom?0!==$(document).find(".holContent").length?$(document).find(".widget > .contenu > ul > li ").css({width:"420px"}):($(document).find(".widget > .contenu > ul > li ").css({width:"800px"}),$(document).find(".widget > .contenu > ul > li > div ").each(function(){void 0!==$(this).data("kendoChart")&&($(this).data("kendoChart").options.chartArea.width=800,$(this).data("kendoChart").resize(),$(this).data("kendoChart").refresh())})):$(document).find(".widget > .contenu > ul > li ").css({display:"inline-block"}):window.matchMedia("(max-width: 1394px)").matches?zoom?0!==$(document).find(".holContent").length?$(document).find(".widget > .contenu > ul > li ").css({width:"520px"}):($(document).find(".widget > .contenu > ul > li ").css({width:"980px"}),$(document).find(".widget > .contenu > ul > li > div ").each(function(){void 0!==$(this).data("kendoChart")&&($(this).data("kendoChart").options.chartArea.width=980,$(this).data("kendoChart").resize(),$(this).data("kendoChart").refresh())})):$(document).find(".widget > .contenu > ul > li ").css({display:"inline-block"}):window.matchMedia("(max-width: 1800px)").matches&&window.matchMedia("(min-width: 1395px)").matches?zoom?0!==$(document).find(".holContent").length?$(document).find(".widget > .contenu > ul > li ").css({width:"650px"}):($(document).find(".widget > .contenu > ul > li ").css({width:"650px"}),$(document).find(".widget > .contenu > ul > li > div ").each(function(){void 0!==$(this).data("kendoChart")&&($(this).data("kendoChart").options.chartArea.width=650,$(this).data("kendoChart").resize(),$(this).data("kendoChart").refresh())})):$(document).find(".widget > .contenu > ul > li ").css({display:"inline-block"}):($(document).find(".categorie > li").css("margin","6px"),zoom&&($(document).find(".widget >.contenu > ul > li ").css({width:"800px"}),$(document).find(".widget > .contenu > ul > li > div ").each(function(){void 0!==$(this).data("kendoChart")&&($(this).data("kendoChart").options.chartArea.width=800,$(this).data("kendoChart").resize(),$(this).data("kendoChart").refresh())})))})},this.setZoom=function(a){zoom=a},this.getZoom=function(){return zoom},this.hideDetailButton=function(context){$(context).find(".fullScreen").remove()},this.showCloseButton=function(){$(".closeButton").show()},this.hideCloseButton=function(){$(".closeButton").hide()},this.disableDragAndDrop=function(){dragAndDrop.disableDragAndDrop("WidgetContainer")},this.enableDragAndDrop=function(){dragAndDrop.enableDragAndDrop("WidgetContainer")},this.exportPDF=function(context){kendo.ui.progress($(context),!0),printWidget.printPdf($(context).data("typeW"),context,$(context).data("index"))},this.detailNuage=function(context,indexDetails){$(context).find(".tags a").click(function(){"nuageNom"===indexDetails?ouvrirDicoNoms(controller.getIdFile(),controller.getPort(),$(this).data("codeid")):"nuagePrenom"===indexDetails?ouvrirDicoPrenoms(controller.getIdFile(),controller.getPort(),$(this).data("codeid")):"nuageProfession"===indexDetails?ouvrirDicoProfessions(controller.getIdFile(),controller.getPort(),$(this).data("codeid")):"lieux"===indexDetails&&ouvrirDicoLieux(controller.getIdFile(),controller.getPort(),$(this).data("codeid"))})},this.ouvrirDicoSourceAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoSources(controller.getIdFile(),controller.getPort())})},this.ouvrirDicoMediaAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoMedias(controller.getIdFile(),controller.getPort(),0)})},this.ouvrirDicoLieuxAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoLieux(controller.getIdFile(),controller.getPort(),0)})},this.ouvrirDicoNomAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoNoms(controller.getIdFile(),controller.getPort(),0)})},this.ouvrirDicoPrenomAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoPrenoms(controller.getIdFile(),controller.getPort(),0)})},this.ouvrirDicoProfessionAction=function(context){$(context).find(".ouvrirDico").click(function(){ouvrirDicoProfessions(controller.getIdFile(),controller.getPort(),0)})},this.ouvrirFicheIndividu=function(context,index){"detailIndi"===index||"detailProg"===index?"union"===$(context).data("type")?getFicheUnion(controller.getIdFile(),controller.getPort(),$(context).data("infoid")):getFicheIndividu(controller.getIdFile(),controller.getPort(),$(context).data("infoid")):"detailEvt"===index?getEvenementIndividu(controller.getIdFile(),controller.getPort(),$(context).data("infoid")):"denombrement"===index?getFicheIndividu(controller.getIdFile(),controller.getPort(),$(context).data("infoid")):"tabGen"===index&&getFicheIndividu(controller.getIdFile(),controller.getPort(),$(context).data("infoid"))},this.connectHOL=function(callback){connectToHOLAccount(controller.getIdFile(),controller.getPort(),callback)},this.getAlbums=function(url,callback){getPhotosFromAlbums(url,callback)},this.publishFileHOL=function(){publishFile(controller.getIdFile(),controller.getPort())},this.saveFileHOL=function(){saveFile(controller.getIdFile(),controller.getPort())}}