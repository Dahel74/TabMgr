function Widget(){var self=this,controller=null,filename="",port=0,uuid="",portee="";this.init=function(c){controller=c,filename=c.getFilename(),port=c.getPort(),uuid=c.getIdFile()};var wiki=new WikiApi;function detailTabGenerations(e){for(var individus=[],keysIndidividusObject=Object.keys(e.data.get("individus")),i=0;i<keysIndidividusObject.length-4;i++)individus.push({links:e.data.get("individus")[keysIndidividusObject[i]].links,mainIndividu:e.data.get("individus")[keysIndidividusObject[i]].mainIndividu,index:keysIndidividusObject[i],implexeFoundCount:e.data.get("individus")[keysIndidividusObject[i]].implexeFoundCount});getDetailGeneration(port,e.data.get("uuid"),individus,portee,function(data){var hideConjoint=!1;portee!==localisedString.HNLOC_DASH_FILTRE_DESCENDANCE&&(hideConjoint=!0);var b=$("<div/>").appendTo(e.detailCell).kendoGrid({dataSource:{data:data,sort:{field:"index",dir:"asc"}},dataBound:function(e){$(".k-grid table").css({"border-collapse":"collapse"}),$(e.sender.element).find("tbody tr").each(function(indexRow){indexRow<$(e.sender.element).find("tbody tr").length-1&&e.sender._data[indexRow].get("codeIdU")!==e.sender._data[indexRow+1].get("codeIdU")&&$(this).css({"border-bottom":"2px solid","border-color":"#BEC3C4"}),$(this).find("td").each(function(indexCell){!0===e.sender._data[indexRow].get("isFicheComplete")&&indexCell>=3&&indexCell<=13?$(this).css("background-color","#FFDFCC"):(indexCell>=3&&indexCell<=5&&!0===e.sender._data[indexRow].get("birthIsCompleted")&&$(this).css("background-color","#FFDFCC"),indexCell>=6&&indexCell<=10&&!0===e.sender._data[indexRow].get("unionIsCompleted")&&$(this).css("background-color","#FFDFCC"),indexCell>=11&&indexCell<=13&&(!0===e.sender._data[indexRow].get("deathIsCompleted")||!0===e.sender._data[indexRow].get("isAssumedAlive"))&&$(this).css("background-color","#FFDFCC"))})})},scrollable:!1,sortable:!0,pageable:!1,columns:[{template:'<img src="#= urlSexe #"   style="visibility:#= displayLinksAndImg#"> #= sosa # ',field:"sosa",title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_SOSA_TITLE,width:"70px"},{field:"nom",template:'<img src="../Common/Resources/completion-oui.png" title="'+localisedString.HNLOC_HINT_INDI_COMPLET+'"  style="display:#= DisplayIsCompleteIcon #;margin:auto;vertical-align:bottom"><span class="lienFicheIndi" data-codeid="#= codeId #" style="cursor:pointer;color:#= implexeIndicator #">#= nom #</span>  ',title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_NAME_TITLE,width:"150px"},{template:'<img src="#= filiation #"  style="visibility:#= displayLinksAndImg#">',title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_AFILIATION_TITLE,width:"65px"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_BIRTH_TITLE,field:"birthIsCompleted",width:"220px",columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdN #" style="cursor:pointer">#= dateN #</span>',field:"dateN",width:"120px"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdN #" style="cursor:pointer">#= lieuN #</span>',field:"lieuN"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" title="#= birthTooltip #" data-typesrc="birthSrcs"  data-codeIdEvt= "#= codeIdN #"    data-dataindex="#= index #" style="padding:0;visibility:#= hasBirthSource #"><img src="../Common/Resources/source.png" ></button>',width:"50px"}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_UNION_TITLE,field:"unionIsCompleted",width:"220px",columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_UNION_MATE,template:'<span class="lienFicheIndi" data-codeid="#= conjoint.codeId #" style="cursor:pointer">#= conjoint.usualNames #</span>',field:"conjoint.usualNames",hidden:hideConjoint},{title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_UNION_CHILDREN_NUMBER,field:"childrenCount",width:"60px",hidden:hideConjoint},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdU #" style="cursor:pointer">#= dateU #</span>',field:"dateU",width:"120px"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdU #" style="cursor:pointer">#= lieuU #</span>',field:"lieuU"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" title="#= unionTooltip #" data-indexunion="#= indexUnion#" data-typesrc="unionSrcs" data-codeIdEvt="#= codeIdU #"   data-dataindex="#= index #" style="padding:0;visibility:#= hasUnionSource #"><img src="../Common/Resources/source.png" ></button>',width:"50px"}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_DEATH_TITLE,field:"deathIsCompleted",width:"220px",columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdD #" style="cursor:pointer">#= dateD #</span>',field:"dateD",width:"100px"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,template:'<span class="lienEvt" data-codeid="#= codeIdD #" style="cursor:pointer">#= lieuD #</span>',field:"lieuD"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" title="#= deathTooltip #" data-typesrc="deathSrcs" data-codeIdEvt="#= codeIdD #"    data-dataindex="#= index #" style="padding:0;visibility:#= hasDeathSource #"><img src="../Common/Resources/source.png" ></button>',width:"50px"}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_NOTES_TITLE,template:'<button class="heredis-button note" data-codeid="#= codeId #"  style="padding:0"><img  src="#= urlIconNote #" ></button>',width:"50px"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_LAST_UPDATE,field:"timestamp",width:"100px"}]});data.sort(function(a,b){return a.index-b.index}),b.data("kendoGrid").dataSource.bind("change",function(){openLinkHandeler()});var openLinkHandeler=function(){$(e.detailCell).find(".note").each(function(){$(this).click(function(){openNote(e.data.get("uuid"),port,$(this).data("codeid"))})}),$(e.detailCell).find(".lienFicheIndi").each(function(){$(this).click(function(){getFicheIndividu(e.data.get("uuid"),port,$(this).data("codeid"))})}),$(e.detailCell).find(".lienEvt").each(function(){$(this).click(function(){getEvenementIndividu(e.data.get("uuid"),port,$(this).data("codeid"))})}),$(e.detailCell).find(".lienSouceSR").each(function(){$(this).click(function(){var context=this,w=$("#popupSrc");1===data[$(context).data("dataindex")][$(context).data("typesrc")].length?"unionSrcs"===$(context).data("typesrc")?getSourceDetail(e.data.get("uuid"),port,data[$(context).data("dataindex")].unions[$(context).data("indexunion")].sources[0].codeId,$(context).data("codeidevt")):getSourceDetail(e.data.get("uuid"),port,data[$(context).data("dataindex")][$(context).data("typesrc")][0].codeId,$(context).data("codeidevt")):w.kendoWindow({width:"380px",minWidth:"380px",maxWidth:"380px",height:"200px",maxHeight:"200px",minHeight:"200px",title:localisedString.HNLOC_SOURCES_WINDOW_TITLE,modal:!0,open:function(){$("#popupSrc").empty();for(var i=0;i<data[$(context).data("dataindex")][$(context).data("typesrc")].length;i++)$("#popupSrc").append('<span  data-codeIdEvt="'+$(context).data("codeidevt")+'"  class="linkSrc" data-codeid="'+data[$(context).data("dataindex")][$(context).data("typesrc")][i].codeId+'">'+data[$(context).data("dataindex")][$(context).data("typesrc")][i].title+"</span>");$("#popupSrc").css("text-align","center"),$("#popupSrc").find(".linkSrc").click(function(){getSourceDetail(e.data.get("uuid"),port,$(this).data("codeid"),$(this).data("codeidevt"))})}}).data("kendoWindow").center().open()})})};openLinkHandeler()})}this.getKendoChart=function(indexUl,type,data,context,page,titre,haveDetail,details,callback){var width=0,height=0,taille=0,stepLabel=1,showLabels=!1,legende="#= value #",labelSeries="  #= value # #: text # ",theme="material",sizeFontLabel="12px sans-serif",marginLabel=5,sizeFontTitle="15px sans-serif",orientationLegende="vertical",padding=0,holeSize=40,majorUnit=void 0,ordreLabel=null,ordreLabelGraphPoint=null;if("fr"===controller.getLanguage()?(ordreLabel="desc",ordreLabelGraphPoint="asc"):"en"===controller.getLanguage()&&(ordreLabel="asc",ordreLabelGraphPoint="desc"),"bar2"===type||"stackBar"===type||"point"===type){for(var max=0,i=0;i<data[0].length;i++)data[0][i].value>max&&(max=data[0][i].value);max<=8&&(majorUnit=1),stepLabel=data[0].length<=70?1:data[0].length>=70&&data[0].length<100?2:data[0].length>=100&&data[0].length<200?5:data[0].length>=200?10:50}details?(width=800,height=400,taille=30,showLabels=!0,legende="#= value # #= category # (#= kendo.format('{0:P}',percentage)#)",labelSeries="#= text #",sizeFontLabel="12px sans-serif",marginLabel=5,holeSize=60,sizeFontTitle="16px sans-serif",orientationLegende="horizontal",padding=7):(taille=20,width=347,height=250);var options="";"donut"===type?options={theme:theme,title:{position:"top",text:titre,font:sizeFontTitle,margin:2},legend:{visible:!0,position:"bottom",labels:{font:sizeFontLabel,template:labelSeries,margin:{left:marginLabel,right:marginLabel,bottom:1}},orientation:orientationLegende},chartArea:{height:height,width:width},seriesColors:["#3f51b5","#03a9f4","#e24d8a","#ffc000","#ff9800","#ff5722"],dataSource:{data:data},series:[{labels:{visible:showLabels,background:"transparent",position:"outsideEnd",template:legende,padding:padding,font:"9px sans-serif",align:"column"},startAngle:70,type:"donut",size:taille,holeSize:holeSize,field:"pourcentage",categoryField:"label",color:"color"}],tooltip:{visible:!0,template:"#= value # #= category # (#= kendo.format('{0:P}', percentage) #)"}}:"bar2"===type?options={theme:theme,title:{position:"top",text:titre,font:sizeFontTitle,margin:2},legend:{visible:!0,position:"bottom",labels:{font:"sizeFontLabel",margin:{left:marginLabel,right:marginLabel,bottom:1}}},chartArea:{height:height,width:width},dataSource:{data:data[0],group:[{field:"type",dir:ordreLabel}],sort:{field:"index",dir:"asc"}},seriesDefaults:{type:"column"},series:[{field:"value"}],seriesColors:data[1],valueAxis:{name:"value",template:"format",line:{visible:!0},minorGridLines:{visible:!1},labels:{rotation:"auto"},majorUnit:majorUnit},zoomable:{mousewheel:!0,selection:!1},pannable:{key:"none"},zoom:function(e){controller.getStateControlButton()||e.preventDefault()},categoryAxis:{field:"date",min:0,title:{text:data[2]},labels:{font:"10px Arial,Helvetica,sans-serif",rotation:"auto",step:stepLabel},majorGridLines:{visible:!1}},tooltip:{visible:!0,template:'#=  kendo.toString(value, "n0") # #= dataItem.type #'},render:function(e){if(void 0!==range){var range=e.sender.getAxis("value").range();range.max<10&&(axis.majorUnit=1)}}}:"stackBar"===type?options={theme:theme,title:{position:"top",text:titre,font:sizeFontTitle,margin:2},legend:{visible:!0,position:"bottom",labels:{font:sizeFontLabel,margin:{left:marginLabel,bottom:1}}},chartArea:{height:height,width:width},dataSource:{data:data[0],group:[{field:"type",dir:ordreLabel}],sort:{field:"index",dir:"asc"}},series:[{type:"column",stack:!0,field:"value"}],seriesColors:data[1],valueAxis:{name:"value",line:{visible:!0},minorGridLines:{visible:!1},labels:{rotation:"auto"}},categoryAxis:{field:"date",title:{text:data[2]},majorGridLines:{visible:!1},labels:{step:stepLabel,font:"10px Arial,Helvetica,sans-serif",rotation:"auto"}},zoomable:{mousewheel:!0,selection:!1},zoom:function(e){controller.getStateControlButton()||e.preventDefault()},pannable:{key:"none"},tooltip:{visible:!0,template:"#= value  # #= dataItem.type #"},render:function(e){var range=e.sender.getAxis("value").range(),axis=e.sender.options.valueAxis;range.max<10&&(axis.majorUnit=1)}}:"area"===type?options={theme:theme,title:{position:"top",text:titre,font:sizeFontTitle,margin:2},legend:{visible:!0,position:"bottom",labels:{font:sizeFontLabel,margin:{left:marginLabel,right:marginLabel,bottom:1}}},chartArea:{height:height,width:width},dataSource:{data:data[0],group:{field:"type",dir:ordreLabel},sort:{field:"index",dir:"asc"}},seriesColors:data[1],seriesDefaults:{type:"area",color:"color",opacity:.5,style:"smooth"},series:[{field:"value"}],valueAxis:{name:"value",line:{visible:!0},minorGridLines:{visible:!1},labels:{rotation:"auto"}},categoryAxis:{field:"date",majorGridLines:{visible:!1},labels:{font:"10px Arial,Helvetica,sans-serif",rotation:"auto"}},zoomable:{mousewheel:!0,selection:!1},zoom:function(e){controller.getStateControlButton()||e.preventDefault()},pannable:{key:"none"},tooltip:{visible:!0,template:" #= value # #= category #"},render:function(e){var range=e.sender.getAxis("value").range(),axis=e.sender.options.valueAxis;range.max<10&&(axis.majorUnit=1)}}:"point"===type&&(options={theme:theme,title:{position:"top",text:titre,font:sizeFontTitle,margin:2},legend:{visible:!0,position:"bottom",labels:{font:sizeFontLabel,margin:{left:marginLabel,bottom:1}},reverse:!0},chartArea:{height:height,width:width},dataSource:{data:data[0],group:[{field:"type",dir:ordreLabelGraphPoint}],sort:{field:"index",dir:"asc"}},series:[{type:"line",style:"smooth",field:"value",missingValues:"interpolate"}],seriesColors:data[1],zoomable:{mousewheel:!0,selection:!1},zoom:function(e){controller.getStateControlButton()||e.preventDefault()},pannable:{key:"none"},valueAxis:{name:"value",line:{visible:!0},minorGridLines:{visible:!1},labels:{rotation:"auto"}},categoryAxis:{field:"date",title:{text:data[2],font:"13px Arial,Helvetica,sans-serif"},majorGridLines:{visible:!1},labels:{step:stepLabel,font:"10px Arial,Helvetica,sans-serif",rotation:"auto"}},tooltip:{visible:!0,template:" #= value #  #= kendoString(category, 'n1') #"},render:function(e){var range=e.sender.getAxis("value").range(),axis=e.sender.options.valueAxis;range.max<10&&(axis.majorUnit=1)}}),"panel"===type?(options=data,$(context).html(options)):context.kendoChart(options),details&&callback(),$(document).keydown(function(evt){17===evt.keyCode&&controller.setStateControlButton(!0)}),$(document).keyup(function(evt){17===evt.keyCode&&controller.setStateControlButton(!1)}),context.resize()},this.getKendoGrid=function(indexUl,type,data,context,page,titre,haveDetail,details,callback){var options,titreGrid="";titreGrid=void 0===data[2]?titre.toUpperCase():titre.toUpperCase()+localisedString.HNLOC_TRAIT_UNION+data[2];var toolbar='<div class="export" style="text-align:center"><button id="exportEXCEL" title="'+localisedString.HNLOC_DASH_TAB_GENERATION_EXPORT_EXCEL_TEXT+'" class="k-button" style="float:right"><span class="k-icon k-i-excel"></span></button><span style="margin-top:50px">'+titre+"</span></div>";options={toolbar:kendo.template(toolbar),excel:{allPages:!0},excelExport:function(e){e.preventDefault();isModeDemo(uuid,port,function(exportPath,encodedFilename){filename=encodedFilename;var sheet=e.workbook.sheets[0],titleRow1={type:"header",cells:[{value:filename+" - "+$("#titre").html(),colSpan:Object.keys(data[0][0]).length,bold:!0,textAlign:"center"}]},titleRow2={type:"header",cells:[{value:titreGrid,colSpan:Object.keys(data[0][0]).length,bold:!0,textAlign:"center"}]};sheet.rows.unshift(titleRow2),sheet.rows.unshift(titleRow1),sheet.freezePane.rowSplit+=2;var dataURL=new kendo.ooxml.Workbook(e.workbook).toDataURL();kendo.saveAs({proxyURL:"http://localhost:"+port+"/libheredis/appServicesDown/download",dataURI:dataURL,fileName:exportPath+encodedFilename+"-"+titre+".xlsx"})})},height:400,pageable:{pageSize:6,buttonCount:4,messages:{display:localisedString.HNLOC_DASH_STATS_DETAIL_GRID_FOOTER}},dataSource:{data:data[0],aggregate:[{field:"naissance",aggregate:"sum"},{field:"deces",aggregate:"sum"},{field:"moyDecesH",aggregate:"average"},{field:"moyDecesF",aggregate:"average"},{field:"decesH",aggregate:"sum"},{field:"decesF",aggregate:"sum"},{field:"moyUnionFemmes",aggregate:"average"},{field:"moyUnionHommes",aggregate:"average"},{field:"moyEftUnion",aggregate:"average"},{field:"count1",aggregate:"sum"},{field:"count2",aggregate:"sum"},{field:"nbUnion",aggregate:"sum"},{field:"nbMariage",aggregate:"sum"},{field:"Trouves",aggregate:"sum"},{field:"Distincts",aggregate:"sum"}]},columns:data[1]};var grid=context.kendoGrid(options);grid.find("#exportEXCEL").click(function(){grid.data("kendoGrid").saveAsExcel()}),details&&callback()},this.getTabGeneration=function(context,dataG,cureentPortee,callback){var expandedRow=[];portee=cureentPortee;var toolbar='<div class="export" style="text-align:center"><button id="exportEXCEL" title="'+localisedString.HNLOC_DASH_TAB_GENERATION_EXPORT_EXCEL_TEXT+'" class="k-button" style="float:right"><span class="k-icon k-i-excel"></span></button><button id="exportPDF" title="'+localisedString.HNLOC_DASH_TAB_GENERATION_EXPORT_PDF_TEXT+'" class="k-button" style="float:right"><span class="k-icon k-i-pdf"></span></button>'+dataG[0][2]+dataG[0][0]+"</div>",options={dataSource:{data:dataG[1]},toolbar:kendo.template(toolbar),detailExpand:function(e){expandedRow.push(e.masterRow.find("#genLabel").attr("cle")),controller.setExpandedGenerations(expandedRow)},detailCollapse:function(e){var indexOfDetail=expandedRow.indexOf(e.masterRow.find("#genLabel").attr("cle"));expandedRow.splice(indexOfDetail,1),controller.setExpandedGenerations(expandedRow)},detailInit:detailTabGenerations,dataBound:function(e){var tmp=controller.getExpandedGenerations();if($(e.sender.element).find("tr.k-master-row").each(function(indexRow,elt){indexRow<$(e.sender.element).find("tr.k-master-row").length&&($(this).css("border-top","2px solid"),$(this).css("border-color","#BEC3C4"))}),0!==tmp.length)for(var i=0;i<tmp.length;i++)this.expandRow(this.tbody.find("[cle="+tmp[i]+"]").parent().parent());else this.expandRow(this.tbody.find("tr.k-master-row").first()),expandedRow.push(this.tbody.find("tr.k-master-row").find("#genLabel").attr("cle")),controller.setExpandedGenerations(expandedRow)},pdfExport:function(e){e.preventDefault();var self=this;$("#apercuTabGen").html('<div style="height:610px;width:830px;overflow:auto"><div id="mainContent" style="width:790px;"></div></div><div style="display:block;margin-top:30px;text-align:center" ><button class="k-button" id="pdf" >'+localisedString.HNLOC_DASH_BUTTON_EXPORT_PDF_LABEL+"</button></div>");var window=$("#apercuTabGen");window.kendoWindow({title:localisedString.HNLOC_EXPORT_WINDOW_TITLE,modal:!0,height:"740px",maxHeight:"740px",minHeight:"740px",width:"860px",activate:function(){$(self.element).find(".k-grid-content tr").each(function(index,elt){$(elt).hasClass("k-master-row")&&($("#apercuTabGen #mainContent").append('<div class="master-row">'+$(elt).clone().html()+"</div>"),$(elt).next().hasClass("k-detail-row")&&$("#apercuTabGen #mainContent").append($(elt).next().find(".k-grid").clone()))}),$("#apercuTabGen .k-grid table").find("colgroup").html('<col style="width:40px"><col style="width:100px"><col style="width:30px"><col style="width:60px"><col><col style="width:30px"><col style="width:60px"><col><col style="width:30px"><col style="width:60px"><col><col style="width:30px"><col style="width:30px"><col style="width:60px">'),$("#apercuTabGen .k-grid table").css({"table-layout":"auto","text-align":"center","font-size":"9px"}),$("#apercuTabGen .k-grid table img").css({width:"12px",height:"12px"}),$("#apercuTabGen .master-row div").css({display:"inline-block"}),$("#apercuTabGen .master-row ").css({"border-top":"1px solid",height:"50px"}),$("#apercuTabGen .k-grid table th").css({"text-align":"center"}),$("#apercuTabGen #mainContent").css({"font-size":"10px",margin:"auto"}),$("#apercuTabGen .progress").css({width:"120px"}),$("#apercuTabGen .tabGenProgresslabel").css("font-size","10px"),$("#apercuTabGen #pdf").click(function(){isModeDemo(uuid,port,function(exportPath,encodedFilename){kendo.drawing.drawDOM($("#apercuTabGen #mainContent"),{paperSize:"A4",landscape:!0,margin:{left:"1cm",top:"1cm",right:"1cm",bottom:"2cm"}}).then(function(group){kendo.drawing.pdf.saveAs(group,exportPath+encodedFilename+"-"+dataG[0][2]+dataG[0][1]+".pdf","http://127.0.0.1:"+port+"/libheredis/appServicesDown/download",function(){window.data("kendoWindow").close()})})})})}}).data("kendoWindow").center().open()},excelExport:function(e){e.preventDefault();var individus=[],indiParam=[],detailDatas=[],currentIndex=0,generations=[],hideConjoint=!1,w=$("#progressWindowExclExprt"),abort=!1,currentExportPath="",nb=0;portee!==localisedString.HNLOC_DASH_FILTRE_DESCENDANCE&&(hideConjoint=!0);var traiteRpd=function(data,callbackNextGeneration){new kendo.ExcelExporter({columns:[{template:'<img src="#= urlSexe #" > #= sosa # ',field:"sosa",title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_SOSA_TITLE},{field:"sexe",title:localisedString.HNLOC_DASH_SEXE},{field:"nom",title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_NAME_TITLE},{field:"filiationExportSymbol",title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_AFILIATION_TITLE},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_BIRTH_TITLE,columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,field:"dateN"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,field:"lieuN"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" data-typeSrc="birthSrcs" data-codeId="#= index #"style="padding:0;visibility:#= hasBirthSource #"><img src="../Common/Resources/source.png" ></button>'}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_UNION_TITLE,columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_UNION_MATE,field:"conjoint.usualNames",hidden:hideConjoint},{title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_UNION_CHILDREN_NUMBER,field:"childrenCount",hidden:hideConjoint},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,field:"dateU"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,field:"lieuU"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" data-typeSrc="unionSrcs" data-codeId="#= index #" style="padding:0;visibility:#= hasUnionSource #"><img src="../Common/Resources/source.png" ></button>'}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_DEATH_TITLE,columns:[{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_DATE_TITLE,field:"dateD"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_PLACE_TITLE,field:"lieuD"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SOURCE_TITLE,template:'<button class="heredis-button lienSouceSR" data-typesrc="deathSrcs" data-codeId="#= index #" style="padding:0;visibility:#= hasDeathSource #"><img src="../Common/Resources/source.png" ></button>',width:"60px"}]},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_NOTES_TITLE,template:'<button class="heredis-button" style="padding:0"><img src="../Common/Resources/note.png" ></button>',field:"noteContent"},{title:localisedString.HNLOC_DASH_TAB_GENERATION_DETAIL_SECTION_LAST_UPDATE,field:"timestamp"}],dataSource:{data:data,sort:{field:"index",dir:"asc"}}}).workbook().then(function(book){detailDatas.push({masterRowIndex:currentIndex,sheet:book.sheets[0],data:data}),void 0!==callbackNextGeneration&&callbackNextGeneration()})},progress=0;console.log(e.data);var recursiveGetIndiFromGen=function(index,listGen){currentIndex=index+1,abort||(index<listGen.length-1?getDetailGeneration(port,e.data[index].get("uuid"),listGen[index],portee,traiteRpd,function(){nb++,progress.value(nb),recursiveGetIndiFromGen(index+=1,listGen)}):index===listGen.length-1&&getDetailGeneration(port,e.data[index].get("uuid"),listGen[index],portee,traiteRpd,function(){nb++,progress.value(nb),detailDatas.sort(function(a,b){return a.masterRowIndex-b.masterRowIndex}),e.workbook.sheets[0].columns.unshift({width:100});for(var i=0;i<e.workbook.sheets[0].rows.length;i++){for(var j=0;j<e.workbook.sheets[0].rows[i].cells.length;j++)e.workbook.sheets[0].rows[i].cells[j].background="#2185A6",e.workbook.sheets[0].rows[i].cells[j].color="#ffffff",e.workbook.sheets[0].rows[i].cells[0].colSpan=2,e.workbook.sheets[0].rows[i].cells[1].colSpan=10;if(i<e.workbook.sheets[0].rows.length-1){var enteteAncetre=kendo.template(localisedString.HNLOC_DASH_TAB_GENERATION_ANCESTOR_MAJ_PLURIEL+" "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUND+": #= trouves# (#=avancementAncetre #%), "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUNDMAX+": #= trouvable #, "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_IMPLEXE+": #= implexe # - "+localisedString.HNLOC_DASH_TAB_GENERATION_REASEARCH_EVT+' : #=kendo.toString(avancementActes,"n0")#%'),enteteGeneration=kendo.template("#= generation #");0===dataG[1][i].implexe&&(enteteAncetre=kendo.template(localisedString.HNLOC_DASH_TAB_GENERATION_ANCESTOR_MAJ_PLURIEL+" "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUND+": #= trouves# (#=avancementAncetre #%), "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUNDMAX+": #= trouvable # - "+localisedString.HNLOC_DASH_TAB_GENERATION_REASEARCH_EVT+' : #=kendo.toString(avancementActes,"n0")#%')),e.workbook.sheets[0].rows[i+1].cells[0].value=enteteGeneration(dataG[1][i]),e.workbook.sheets[0].rows[i+1].cells[1].value=enteteAncetre(dataG[1][i])}}for(i=detailDatas.length-1;i>=0;i--){for(var masterRowIndex=detailDatas[i].masterRowIndex,sheet=detailDatas[i].sheet,t=0;t<detailDatas[i].data.length;t++)for(var indexRow=0;indexRow<detailDatas[i].sheet.rows.length;indexRow++)detailDatas[i].sheet.rows[indexRow].cells[2].value===detailDatas[i].data[t].nom&&(detailDatas[i].data[t].isFicheComplete?(detailDatas[i].sheet.rows[indexRow].cells[3].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[4].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[5].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[6].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[7].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[8].background="#FFDFCC"):(detailDatas[i].data[t].birthIsCompleted&&(detailDatas[i].sheet.rows[indexRow].cells[4].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[5].background="#FFDFCC"),detailDatas[i].data[t].unionIsCompleted&&(detailDatas[i].sheet.rows[indexRow].cells[6].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[7].background="#FFDFCC"),(detailDatas[i].data[t].deathIsCompleted||detailDatas[i].data[t].isAssumedAlive)&&(detailDatas[i].sheet.rows[indexRow].cells[8].background="#FFDFCC",detailDatas[i].sheet.rows[indexRow].cells[9].background="#FFDFCC")),"#FF0000"===detailDatas[i].data[t].implexeIndicator&&(detailDatas[i].sheet.rows[indexRow].cells[2].color="#FF0000"),detailDatas[i].data[t].isFicheComplete&&(detailDatas[i].sheet.rows[indexRow].cells[2].value=detailDatas[i].sheet.rows[indexRow].cells[2].value+" ("+localisedString.HNLOC_COMPLET+")"));[].splice.apply(e.workbook.sheets[0].rows,[masterRowIndex+1,0].concat(sheet.rows))}var titleRow1={type:"header",cells:[{},{},{},{},{},{value:filename+" - "+$("#titre").html(),bold:!0,textAlign:"center"}]},titleRow2={type:"header",cells:[{},{},{},{},{},{value:dataG[0][2]+dataG[0][1],bold:!0,textAlign:"center"}]};e.workbook.sheets[0].rows.unshift(titleRow2),e.workbook.sheets[0].rows.unshift(titleRow1),kendo.saveAs({proxyURL:"http://127.0.0.1:"+port+"/libheredis/appServicesDown/download",dataURI:new kendo.ooxml.Workbook(e.workbook).toDataURL(),fileName:currentExportPath+filename+"-"+dataG[0][2]+dataG[0][1]+".xlsx"}),w.data("kendoWindow").close()}))};isModeDemo(uuid,port,function(exportPath,encodedFilename){filename=encodedFilename,currentExportPath=exportPath,w.kendoWindow({width:"400px",minWidth:"400px",maxWidth:"400px",height:"100px",maxHeight:"100px",minHeight:"100px",title:localisedString.HNLOC_EXPORT_EXCEL_WINDOW_TITLE,modal:!0,open:function(){$("#progressWindowExclExprt").empty(),$("#progressWindowExclExprt").html('<div class="progressExport"></div><button class="k-button cancelExport">'+localisedString.HNLOC_DASH_TAB_GENERATION_EXPORT_EXCEL_ABORT+"</button>"),abort=!1},actions:[]}).data("kendoWindow").center().open(),$("#progressWindowExclExprt").find(".cancelExport").click(function(){abort=!0,$.xhrPool.abortAll(function(){test(e.data[0].get("uuid"),port),w.data("kendoWindow").close()})});for(var rowIndex=0;rowIndex<e.data.length;rowIndex++){var deferred=$.Deferred();individus=[],indiParam.push(deferred);for(var keysIndidividusObject=Object.keys(e.data[rowIndex].get("individus")),i=0;i<keysIndidividusObject.length-4;i++)individus.push({links:e.data[rowIndex].get("individus")[keysIndidividusObject[i]].links,mainIndividu:e.data[rowIndex].get("individus")[keysIndidividusObject[i]].mainIndividu,index:keysIndidividusObject[i],implexeFoundCount:e.data[rowIndex].get("individus")[keysIndidividusObject[i]].implexeFoundCount});deferred.resolve(individus)}$.when.apply($,indiParam).done(function(arg){generations=$.makeArray(arguments),progress=$("#progressWindowExclExprt").find(".progressExport").kendoProgressBar({type:"percent",max:generations.length,animation:{duration:100}}).data("kendoProgressBar"),recursiveGetIndiFromGen(0,generations)})})},sortable:!0,pageable:!1,columns:[{field:"generation",title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_GENERATION_TITLE,template:kendo.template('<div style="text-align:center" cle="#= cle #" id="genLabel"> #= generation# </div>'),width:"100px"},{field:"trouves",title:localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_TITLE,width:"620px",template:kendo.template('<div class="generationCount" >'+localisedString.HNLOC_DASH_TAB_GENERATION_ANCESTOR_MAJ_PLURIEL+" "+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUND+localisedString.HNLOC_2_POINTS+'#= trouves#, <span class="foundCountContainer">'+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_FOUNDMAX+localisedString.HNLOC_2_POINTS+'#= trouvable #</span><span style="visibility:#= noImplexe #">, '+localisedString.HNLOC_DASH_TAB_GENERATION_SECTION_ANCESTOR_COUNT_IMPLEXE+' :  #= implexe # </span> </div> <div class="tabGenprogressContainer tabGenprogressContainerAncetre"><span class=" tabGenProgresslabel">'+localisedString.HNLOC_DASH_TAB_GENERATION_REASEARCH_ANCESTOR+'</span><div class="progress ancetre ancetre#= cle#"></div></div><div class="tabGenprogressContainer"><span class="tabGenProgresslabel">'+localisedString.HNLOC_DASH_TAB_GENERATION_REASEARCH_EVT+'</span><div class="progress actes actes#= cle#"></div></div>')}]};if(dataG[1].length>0){for(var grid=$(context).kendoGrid(options),i=0;i<dataG[1].length;i++)$(context).find(".ancetre"+dataG[1][i].cle).kendoProgressBar({type:"percent",max:100,animation:{duration:100}}),$(context).find(".ancetre"+dataG[1][i].cle).data("kendoProgressBar").value(dataG[1][i].avancementAncetre),$(context).find(".actes"+dataG[1][i].cle).kendoProgressBar({type:"percent",max:100,animation:{duration:100}}),$(context).find(".actes"+dataG[1][i].cle).data("kendoProgressBar").value(dataG[1][i].avancementActes);grid.find("#exportEXCEL").click(function(){grid.data("kendoGrid").saveAsExcel()}),grid.find("#exportPDF").click(function(){grid.data("kendoGrid").saveAsPDF()})}else $(context).html('<div class="defautViewKendo">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div>"),$(".tabGeneration").css("width","30%");void 0!==callback&&callback()},this.getCompteurs=function(indexUl,type,data,context,page,titre,haveDetail,getRemoteData,callback){callback()},this.getCloudWord=function(indexUl,type,data,context,page,titre,haveDetail,getRemoteData,callback){$.fn.tagcloud.defaults={size:{start:7,end:18,unit:"pt"},color:{start:"#424E6A",end:"#2671d5"}},0===$(context).find(".tags a").length?$(context).find(".tags").html('<div class="defautViewKendo k-shadow">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div></div>"):($(context).find(".tags a").css("display","inline-block"),$(context).find(".tags a").tagcloud()),callback()},this.getEphemeride=function(cache,type,data,context,page,callback){wiki.init("fr"),wiki.getEphemeride(cache,context,"",page,callback)},this.getLieux=function(indexUl,type,data,context,page,titre,haveDetail,getRemoteData,callback){self.getCloudWord(indexUl,type,[],$(context).find(".nuage"),page,titre,!1,getRemoteData,function(){callback()}),0===data[1].length?$(context).find(".miniature").html('<div class="defautViewKendo">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div>"):self.getKendoChart(indexUl,"donut",data[1],$(context).find(".pourcentageLGEO"),"",data[0],!1)},this.getHOL=function(indexUl,type,data,context,page,callback){self.getProgressBar(context,data),callback()},this.getProgressBar=function(context,data){0!==$(context).find("#progressBarSvgd").length&&($(context).find("#progressBarSvgd").kendoProgressBar({type:"percent",max:100,animation:{duration:100}}),$(context).find("#progressBarSvgd").data("kendoProgressBar").value(data[0]))},this.getWSWithGraph=function(indexUl,type,data,context,page,titre,haveDetail,getRemoteData,callback){0===data[1].length?($(context).find(".miniature").html('<div class="defautViewKendo">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div>"),$(context).parent().parent().find(".fullScreen").toggleClass("disableButton"),$(context).parent().parent().find(".fullScreen").prop("disabled",!0),$(context).parent().parent().find(".pdf").toggleClass("disableButton"),$(context).parent().parent().find(".pdf").prop("disabled",!0)):0!==data[1][0].length?"naissanceDeces"===type||"denombrement"===type||"tabGenSimple"===type||"progression"===type?"denombrement"===type?self.getKendoChart(indexUl,"bar2",data[1],$(context).find(".miniature"),"",data[0],!1):self.getKendoChart(indexUl,"bar2",data[1],$(context).find(".miniature"),page,data[0],!1):"union"===type||"difference"===type?self.getKendoChart(indexUl,"point",data[1],$(context).find(".miniature"),page,data[0],!1):self.getKendoChart(indexUl,"donut",data[1],$(context).find(".miniature"),page,data[0],!1):($(context).find(".miniature").html('<div class="defautViewKendo">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div>"),$(context).parent().parent().find(".fullScreen").toggleClass("disableButton"),$(context).parent().parent().find(".fullScreen").prop("disabled",!0),$(context).parent().parent().find(".pdf").toggleClass("disableButton"),$(context).parent().parent().find(".pdf").prop("disabled",!0)),callback()}}