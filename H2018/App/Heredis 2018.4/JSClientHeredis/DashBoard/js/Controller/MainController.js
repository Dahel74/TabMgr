function MainController(){var language="",widgetAccueil=[],widgetTabGen=[],widgetEchosDuJour=[],widgetStats=[],widgetInfosFichiers=[],cacheWidget={},filtre={},idProcessHOL=0,mapFavoris={},currentDateOfCache=0,lastDetailCall={},self=this,page="",stateCtrlButton=!1,currentPeriode=0,periodeIntitule=localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE,currentPortee="all",pc=0,pr=0,mapPeriodeValues={},mapPorteeValues={},port=0,idFile=0,filename="",widgets=new Widget,eventHandler=new EventHandler;this.init=function(){console.log(window.location.href);var query=window.location.search.substring(1),query_string=parseArgsfromServer(query);idFile=query_string.uuid,port=query_string.port,filename=decodeURIComponent(query_string.fileName),page=query_string.onglet,"fr"===(language=query_string.language)?(kendo.culture("fr-FR"),loadJSFile("../Externals/kendoUI/js/kendo.messages.fr-FR.min.js")):"en"===language&&(kendo.culture("en-US"),loadJSFile("../Externals/kendoUI/js/kendo.messages.en-US.min.js")),$.xhrPool=[],$.xhrPool.abortAll=function(callback){$(this).each(function(i,jqXHR){jqXHR.abort(),$.xhrPool.splice(i,1)}),void 0!==callback&&callback()},$.ajaxSetup({beforeSend:function(xhr){xhr.setRequestHeader("Authorization","Basic "+btoa("Heredis:"+query_string.password)),"none"===this.indexWidget&&$.xhrPool.push(xhr)},complete:function(xhr){var i=$.xhrPool.indexOf(xhr);if(i>-1&&$.xhrPool.splice(i,1),void 0!==this.indexWidget&&"none"!==this.indexWidget){var cachePorteeWidget={all:{},sosa:{},asc:{},desc:{}},nomWidget=this.indexWidget;"tabGenDetail"===nomWidget?uploadCache("data_"+nomWidget+"_"+mapPorteeValues[localStorage.getItem("portee")],self.getIdFile(),self.getPort(),JSON.stringify(cacheWidget[nomWidget]),function(){$("#loading-info").data("kendoWindow").close()}):"ephemeride"===nomWidget?downloadCache("data_"+nomWidget,self.getIdFile(),self.getPort(),function(data){uploadCache("data_"+nomWidget,self.getIdFile(),self.getPort(),JSON.stringify(cacheWidget[nomWidget]),function(){})}):"holExtraData"===nomWidget?(localStorage.setItem("hol",JSON.stringify(cacheWidget.hol)),localStorage.setItem("HOLAccountInfo",JSON.stringify(cacheWidget.HOLAccountInfo))):"detailHol"===nomWidget?localStorage.setItem("detailHol",JSON.stringify(cacheWidget.detailHol)):downloadCache("data_"+nomWidget,self.getIdFile(),self.getPort(),function(data){""!==data&&(cachePorteeWidget=JSON.parse(data)),cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]=cacheWidget[nomWidget],uploadCache("data_"+nomWidget,self.getIdFile(),self.getPort(),JSON.stringify(cachePorteeWidget),function(){})})}}}),query_string.password,widgets.init(self),getLocalisedStrings(localisedKeys,function(){loadMenus(function(){$("#option").attr("title",localisedString.HNLOC_DASH_BUTTON_OPTION_HINT),$("#updateCache").attr("title",localisedString.HNLOC_DASH_BUTTON_REFRESH_HINT),$(".back-to-top div").html(localisedString.HNLOC_DASH_BACKTOTOP_LABEL),$("#loading-info").html("<span>"+localisedString.HNLOC_LOADING_TEXT+"<span>"),mapPeriodeValues[localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE]=1,mapPeriodeValues[localisedString.HNLOC_DASH_PERIODE_WEEK_TITLE]=7,mapPeriodeValues[localisedString.HNLOC_DASH_PERIODE_MONTH_TITLE]=30,mapPeriodeValues[localisedString.HNLOC_DASH_PERIODE_YEAR_TITLE]=365,mapPorteeValues[localisedString.HNLOC_DASH_FILTRE_ALL]="all",mapPorteeValues[localisedString.HNLOC_DASH_FILTRE_SOSA]="sosa",mapPorteeValues[localisedString.HNLOC_DASH_FILTRE_ASCENDANCE]="asc",mapPorteeValues[localisedString.HNLOC_DASH_FILTRE_DESCENDANCE]="desc",loadCache(function(){self.setCurrentPortee(self.getCurrentPortee())}),$("nav ul li").each(function(){$(this).attr("id")===page?($(this).toggleClass("active"),$(this).css("color","rgb(128, 128, 128)")):($(this).removeClass("active"),$(this).css("color","rgb(255, 255, 255)"))}),$("nav ul li").click(function(e){$(" nav ul li").each(function(){$(this).attr("id")===$(e.target).attr("id")?($(this).toggleClass("active"),$(this).css("color","rgb(128, 128, 128)")):($(this).removeClass("active"),$(this).css("color","rgb(255, 255, 255)"))}),eventHandler.getZoom()&&eventHandler.setZoom(!1),self.redirects(event.target.id)})})}),eventHandler.responsive()};var loadHelpPage=function(){var win=$("#helpPrefsDHB");win.html(pageAide),win.kendoWindow({width:"500px",minWidth:"500px",maxWidth:"500px",height:"500px",maxHeight:"500px",minHeight:"500px",actions:["close"],modal:!0,activate:function(){win.find("#content .titreSectionAideOptions").html(localisedString.HNLOC_DASH_HELP_OPTIONS_TITLE),win.find("#content .contentSectionAideGenDetail").html(localisedString.HNLOC_DASH_HELP_TABGEN_TEXT),win.find("#content .contentSectionAideOptionListe").html("<li>"+localisedString.HNLOC_DASH_PERIODE_LABEL+localisedString.HNLOC_2_POINTS+localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE+" / "+localisedString.HNLOC_DASH_PERIODE_WEEK_TITLE+" / "+localisedString.HNLOC_DASH_PERIODE_MONTH_TITLE+" / "+localisedString.HNLOC_DASH_PERIODE_YEAR_TITLE+".</li>"),win.find("#content .contentSectionAideOptionListe").append("<li> "+localisedString.HNLOC_DASH_FILTRE_LABEL+localisedString.HNLOC_2_POINTS+localisedString.HNLOC_DASH_FILTRE_ALL+" / "+localisedString.HNLOC_DASH_FILTRE_SOSA+" / "+localisedString.HNLOC_DASH_FILTRE_ASCENDANCE+".</li>"),win.find("#content .contentSectionAideOptionValider").html(localisedString.HNLOC_DASH_HELP_OPTIONS_TEXT),win.find("#content .titreSectionAideGenDetail").html(localisedString.HNLOC_DASH_HELP_TABGEN_TITLE),win.find("#content .contentSectionAideOption").html(localisedString.HNLOC_DASH_HELP_OPTIONS_MAINTEXT),win.find("#fermerHelpPrefs").html(localisedString.HNLOC_DASH_BUTTON_CLOSE_LABEL),win.find("#fermerHelpPrefs").click(function(){win.data("kendoWindow").close()})}}).data("kendoWindow").center().open()},loadMenus=function(callback){var menus='<li  id="accueil" >'+localisedString.HNLOC_DASH_MENU_HOME+'</li><li  id="infosFichiers" >'+localisedString.HNLOC_DASH_MENU_FILEINFO+'</li><li  id="stats" >'+localisedString.HNLOC_DASH_MENU_STATS+'</li><li  id="tabGen" ">'+localisedString.HNLOC_DASH_MENU_TABGEN+"</li>";$("#itemsMenu").append(menus),callback()},getLocalisedStrings=function(keys,callback){$.ajax({url:"http://127.0.0.1:"+port+"/libheredis/local/get",type:"POST",dataType:"json",data:keys,success:function(data){localisedString=data,callback()}})},loadJSFile=function(url){var jsElm=document.createElement("script");jsElm.type="application/javascript",jsElm.src=url,document.body.appendChild(jsElm)};this.getExpandedGenerations=function(){return void 0===filtre.tabGenDetail&&(filtre.tabGenDetail=[],localStorage.setItem("filtre",JSON.stringify(filtre)),self.uploadCache("paramsDhb")),filtre.tabGenDetail},this.setExpandedGenerations=function(expandedRow){filtre.tabGenDetail=expandedRow,localStorage.setItem("filtre",JSON.stringify(filtre)),self.uploadCache("paramsDhb")},this.setStateControlButton=function(state){stateCtrlButton=state},this.getStateControlButton=function(state){return stateCtrlButton},this.getIdFile=function(){return idFile},this.getPort=function(){return port},this.getPage=function(){return page},this.getFilename=function(){return filename},this.getLanguage=function(){return language},this.setCurrentPeriode=function(periode){periodeIntitule=periode,currentPeriode=mapPeriodeValues[periode],localStorage.setItem("periode",periode)},this.getPeriodeIntitule=function(){return null==periodeIntitule&&(periodeIntitule=localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE),periodeIntitule},this.setCurrentPortee=function(portee,callback){currentPortee=portee,localStorage.setItem("portee",currentPortee);var window=$("#loading-info");void 0!==window.data("kendoWindow")?window.data("kendoWindow").open():window.kendoWindow({width:"300px",minWidth:"300px",maxWidth:"300px",height:"100px",maxHeight:"100px",minHeight:"100px",actions:[],modal:!0}).data("kendoWindow").center().open(),setPortee(idFile,port,mapPorteeValues[currentPortee],function(){window.data("kendoWindow").close(),self.updateCache()}),savePrefs()},this.getCurrentPortee=function(){var portee=localStorage.getItem("portee");return null===portee||"null"===portee?localisedString.HNLOC_DASH_FILTRE_ALL:portee},this.setZoom=function(zoom){eventHandler.setZoom(zoom)},this.emptyCache=function(){$.removeCookie("accueil"),$.removeCookie("infosFichiers"),$.removeCookie("stats"),$.removeCookie("echosDuJour"),$.removeCookie("favoris"),$.removeCookie("portee"),cacheWidget={},localStorage.clear(),filtre={},self.uploadCache("paramsDhb")},this.refresh=function(callback){!0===eventHandler.getZoom()?self.getVueDetailleWidget(lastDetailCall.index,lastDetailCall.context,lastDetailCall.callback):self.redirects(page),void 0!==callback&&callback()},this.redirects=function(Page,callback){page=Page,$("#WidgetContainer").html(MainSqueleton),"tabGen1"===page?$("#WidgetContainer").html():loadDataFromPersistence(page,function(w){refreshPageWidget("WidgetContainer",w,page,callback),eventHandler.init(self),void 0!==callback&&callback()})},this.uploadCache=function(typeSauvegarde){var cacheParamsDshb={positionWidgets:{infosFichiers:JSON.parse(localStorage.getItem("infosFichiers")),accueil:JSON.parse(localStorage.getItem("accueil")),stats:JSON.parse(localStorage.getItem("stats")),tabGen:JSON.parse(localStorage.getItem("tabGen"))},personnage:{pc:pc,pr:pr},filtre:JSON.parse(localStorage.getItem("filtre")),portee:localStorage.getItem("portee"),periode:localStorage.getItem("periode"),lastUpdate:currentDateOfCache,favoris:JSON.parse(localStorage.getItem("favoris"))};uploadCache(typeSauvegarde,self.getIdFile(),self.getPort(),JSON.stringify(cacheParamsDshb),function(){newData=!1})},this.downloadCache=function(callback){localStorage.clear(),downloadCache("paramsDhb",self.getIdFile(),self.getPort(),function(data){if(""!==data){var globalCache=JSON.parse(data);if(void 0!==globalCache.personnage.pc&&(localStorage.setItem("pc",JSON.stringify(globalCache.personnage.pc)),pc=globalCache.personnage.pc),void 0!==globalCache.personnage.pr&&(localStorage.setItem("pr",JSON.stringify(globalCache.personnage.pr)),pr=globalCache.personnage.pr),void 0!==globalCache.lastUpdate&&(currentDateOfCache=globalCache.lastUpdate),localStorage.setItem("infosFichiers",JSON.stringify(globalCache.positionWidgets.infosFichiers)),localStorage.setItem("accueil",JSON.stringify(globalCache.positionWidgets.accueil)),localStorage.setItem("stats",JSON.stringify(globalCache.positionWidgets.stats)),void 0!==globalCache.favoris&&null!==globalCache.favoris&&localStorage.setItem("favoris",JSON.stringify(globalCache.favoris)),void 0!==globalCache.portee&&null!==globalCache.portee)localStorage.setItem("portee",globalCache.portee);else{var prt=getCurrentPortee();localStorage.setItem("portee",prt)}void 0!==globalCache.periode&&null!==globalCache.periode?(localStorage.setItem("periode",globalCache.periode),periodeIntitule=localStorage.getItem("periode")):self.setCurrentPeriode(self.getPeriodeIntitule()),void 0!==globalCache.filtre&&null!==globalCache.filtre?(localStorage.setItem("filtre",JSON.stringify(globalCache.filtre)),filtre=JSON.parse(localStorage.getItem("filtre"))):(filtre={},localStorage.setItem("filtre",JSON.stringify(filtre)))}void 0!==callback&&callback()})};var loadCache=function(callback){self.downloadCache(function(){callback()})};this.updateCache=function(){var update=!1;checkForUpdate(idFile,port,currentDateOfCache,0,function(data){data>currentDateOfCache&&(currentDateOfCache=data,update=!0)},function(data){pr!==data.pr||pc!==data.pc?(pr=data.pr,pc=data.pc,self.resetCacheDatas(function(){self.refresh(),self.uploadCache("paramsDhb")})):update?self.resetCacheDatas(function(){self.refresh(),self.uploadCache("paramsDhb")}):self.refresh()},function(){self.refresh()})};var getWidgetsOfPage=function(page,callback){var widgets=[];return"accueil"===page?widgets=widgetAccueil:"infosFichiers"===page?widgets=widgetInfosFichiers:"stats"===page?widgets=widgetStats:"echosDuJour"===page?widgets=widgetEchosDuJour:"tabGen"===page&&(widgets=widgetTabGen),null===widgets||0===widgets.length?loadDataFromPersistence(page,function(w){widgets=w,void 0!==callback&&callback(widgets)}):void 0!==callback&&callback(widgets),widgets},loadDataFromPersistence=function(page,callback){var widgets=[];"accueil"===page?(null===(widgetAccueil=JSON.parse(localStorage.getItem(page)))&&self.reset("accueil",self.uploadCache),mapFavoris=JSON.parse(localStorage.getItem("favoris")),widgets=widgetAccueil):"infosFichiers"===page?(null===(widgetInfosFichiers=JSON.parse(localStorage.getItem(page)))&&self.reset("infosFichiers",self.uploadCache),widgets=widgetInfosFichiers):"stats"===page?(null===(widgetStats=JSON.parse(localStorage.getItem(page)))&&self.reset("stats",self.uploadCache),widgets=widgetStats):"echosDuJour"===page?(null===(widgetEchosDuJour=JSON.parse(localStorage.getItem(page)))&&self.reset("echosDuJour",self.uploadCache),widgets=widgetEchosDuJour):"tabGen"===page&&(null===(widgetTabGen=JSON.parse(localStorage.getItem(page)))&&self.reset("tabGen",self.uploadCache),widgets=widgetTabGen),function(widgets,callback){cacheWidget={};var compteurWidgetTraite=0;0===widgets.length?callback():$.each(widgets,function(index,value){if("tabGenDetail"===value[0])try{downloadCache("data_"+value[0]+"_"+mapPorteeValues[localStorage.getItem("portee")],self.getIdFile(),self.getPort(),function(data){""!==data&&(cacheWidget[value[0]]=JSON.parse(data)),++compteurWidgetTraite===widgets.length&&callback()})}catch(e){console.log(e)}else if("ephemeride"===value[0])try{downloadCache("data_ephemeride",self.getIdFile(),self.getPort(),function(data){void 0!==data&&""!==data&&"undefined"!==data&&(cacheWidget.ephemeride=JSON.parse(data)),++compteurWidgetTraite===widgets.length&&callback()})}catch(e){console.log(e)}else if("hol"===value[0])try{null!==localStorage.getItem("hol")&&null!==localStorage.getItem("HOLAccountInfo")&&(cacheWidget.hol=JSON.parse(localStorage.getItem("hol")),cacheWidget.HOLAccountInfo=JSON.parse(localStorage.getItem("HOLAccountInfo"))),++compteurWidgetTraite===widgets.length&&callback()}catch(e){console.log(e)}else try{var cachePorteeWidget="";downloadCache("data_"+value[0],self.getIdFile(),self.getPort(),function(data){""!==data&&void 0!==(cachePorteeWidget=JSON.parse(data))[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget[value[0]]=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]),++compteurWidgetTraite===widgets.length&&callback()})}catch(e){console.log(e)}})}(widgets,function(){if(void 0!==callback){for(var i=0;i<widgets.length;i++);callback(widgets)}})},setFavorisState=function(page,index,state){"infosFichiers"===page?(widgetInfosFichiers=JSON.parse(localStorage.getItem(page)))[index][4]=state:"stats"===page?(widgetStats=JSON.parse(localStorage.getItem(page)))[index][4]=state:"echosDuJour"===page?(widgetEchosDuJour=JSON.parse(localStorage.getItem(page)))[index][4]=state:"tabGen"===page&&(widgetTabGen[index][4]=state),savePositionWidget(page,self.uploadCache)},savePrefs=function(){self.uploadCache("paramsDhb")},savePositionWidget=function(page,callback){"infosFichiers"===page?localStorage.setItem("infosFichiers",JSON.stringify(widgetInfosFichiers)):"accueil"===page?localStorage.setItem("accueil",JSON.stringify(widgetAccueil)):"stats"===page?localStorage.setItem("stats",JSON.stringify(widgetStats)):"echosDuJour"===page?localStorage.setItem("echosDuJour",JSON.stringify(widgetEchosDuJour)):"tabGen"===page&&localStorage.setItem("tabGen",JSON.stringify(widgetTabGen)),void 0!==callback&&callback("paramsDhb")};this.resetCacheDatas=function(callback){cacheWidget={},clearCache(idFile,port,callback),localStorage.removeItem("hol"),localStorage.removeItem("HOLAccountInfo"),localStorage.removeItem("detailHol"),localStorage.removeItem("holExtraData")};this.reset=function(page,callback){"accueil"===page?((widgetAccueil=[]).push(["hol","HNLOC_DASH_HOL_TITLE",!0,getHOL.name,!0]),widgetAccueil.push(["individus","HNLOC_DASH_INDIVIDUS_TITLE",!0,getNbIndivSosas.name,!0]),widgetAccueil.push(["naissanceDeces","HNLOC_DASH_NAISSANCEDECES_TITLE",!0,getNaissanceDeces.name,!0]),widgetAccueil.push(["evenements","HNLOC_DASH_EVENTS_TITLE",!0,getStatsEvenements.name,!0]),widgetAccueil.push(["nuageNom","HNLOC_DASH_NUAGENOM_TITLE",!1,getNuageNom.name,!1]),widgetAccueil.push(["tabGenSimple","HNLOC_DASH_TAB_GENERATION_TITLE",!0,getTabGen.name,!0]),mapFavoris={hol:"infosFichiers",individus:"infosFichiers",naissanceDeces:"stats",evenements:"infosFichiers",nuageNom:"infosFichiers",tabGenSimple:"echosDuJour"},"fr"===language&&(widgetAccueil.push(["ephemeride","HNLOC_DASH_EPHEMERIDE_TITLE",!1,getEph.name,!1]),mapFavoris.ephemeride="echosDuJour"),localStorage.setItem("favoris",JSON.stringify(mapFavoris))):"infosFichiers"===page?((widgetInfosFichiers=[]).push(["hol","HNLOC_DASH_HOL_TITLE",!0,getHOL.name,!0]),widgetInfosFichiers.push(["progression","HNLOC_DASH_PROGRESS_TITLE",!0,getProgression.name,!1]),widgetInfosFichiers.push(["individus","HNLOC_DASH_INDIVIDUS_TITLE",!0,getNbIndivSosas.name,!0]),widgetInfosFichiers.push(["evenements","HNLOC_DASH_EVENTS_TITLE",!0,getStatsEvenements.name,!0]),widgetInfosFichiers.push(["lieux","HNLOC_DASH_LIEUX_TITLE",!1,getLieux.name,!1]),widgetInfosFichiers.push(["sources","HNLOC_DASH_PERCENT_SOURCE_TITLE",!1,getSources.name,!1]),widgetInfosFichiers.push(["nuageNom","HNLOC_DASH_NUAGENOM_TITLE",!1,getNuageNom.name,!0]),widgetInfosFichiers.push(["nuagePrenom","HNLOC_DASH_NUAGEPRENOM_TITLE",!1,getNuagePrenom.name,!1]),widgetInfosFichiers.push(["nuageProfession","HNLOC_DASH_NUAGEPROFESSION_TITLE",!1,getNuageProfession.name,!1]),widgetInfosFichiers.push(["media","HNLOC_DASH_MEDIA_TITLE",!1,getMedia.name,!1])):"stats"===page?((widgetStats=[]).push(["naissanceDeces","HNLOC_DASH_NAISSANCEDECES_TITLE",!0,getNaissanceDeces.name,!0]),widgetStats.push(["origines","HNLOC_DASH_ORIGINE_TITLE",!0,getOriginesAncetre.name,!1]),widgetStats.push(["union","HNLOC_DASH_UNION_TITLE",!0,getUnion.name,!1]),widgetStats.push(["denombrement","HNLOC_DASH_DENOMBREMENT_TITLE",!0,getDenombrement.name,!1]),widgetStats.push(["patronymesPrenomsCourants","HNLOC_DASH_NOMSPRENOMS_TITLE",!0,getPatronymesPrenomsCourants.name,!1]),widgetStats.push(["difference","HNLOC_DASH_DIFFAGE_TITLE",!0,getDifferenceAge.name,!1])):"echosDuJour"===page?(widgetEchosDuJour=[],"fr"===language&&widgetEchosDuJour.push(["ephemeride","HNLOC_DASH_EPHEMERIDE_TITLE",!1,getEph.name,!0]),widgetEchosDuJour.push(["tabGenSimple","HNLOC_DASH_TAB_GENERATION_TITLE",!0,getTabGen.name,!0])):"tabGen"===page&&(widgetTabGen=[]).push(["tabGenDetail","HNLOC_DASH_EPHEMERIDE_TITLE",!1,mainTabGen.name,!1]),savePositionWidget(page,callback)};var loadTabGen=function(context,data){void 0===$.cookie("firstInstall")&&(loadHelpPage(),$.cookie("firstInstall",!0,{expires:365}));var portee=self.getCurrentPortee();$("#WidgetContainer").css("margin-bottom","70px"),portee===localisedString.HNLOC_DASH_FILTRE_SOSA||portee===localisedString.HNLOC_DASH_FILTRE_ALL?3!==data[0].length&&data[0].push(localisedString.HNLOC_ASCENDANCY_OF):portee===localisedString.HNLOC_DASH_FILTRE_ASCENDANCE&&3!==data[0].length&&data[0].push(""),widgets.getTabGeneration(context.find(".tabGeneration"),data,portee,function(){portee===localisedString.HNLOC_DASH_FILTRE_DESCENDANCE&&(context.find(".tabGeneration .tabGenprogressContainerAncetre").remove(),context.find(".tabGeneration .foundCountContainer").remove()),context.find(".persoInfos").click(function(){eventHandler.ouvrirFicheIndividu(this,"tabGen")})})},addWidget=function(type,data,page,titre,currentLi,callback,indexDetails){void 0===filtre[type]&&(filtre[type]={});var newWidget=$(currentLi).find(".widget > .contenu > div").last(),index=$(currentLi).index(),haveDetail=$(currentLi).data("detail"),favoris=$(currentLi).data("favoris");"accueil"===page&&$(currentLi).find(".addToHomePage").css("display","none"),$(newWidget).parent().parent().data("typeW","simple"),$(currentLi).find(".pdf").click(function(event){var context;context=$(event.target).is("img")||$(event.target).is("span")?event.target.parentElement.parentElement.parentElement.parentElement:event.target.parentElement.parentElement.parentElement,eventHandler.exportPDF(context,this)}),"true"===haveDetail&&$(newWidget).parent().parent().data("index",type),"true"===favoris?($(currentLi).find(".addToHomePage").attr("title",localisedString.HNLOC_DASH_BOUTON_FERMER),$(currentLi).find(".addToHomePage >img").attr("src","../Common/Resources/icon/favoris_on.png")):"false"===favoris&&$(currentLi).find(".addToHomePage").attr("title",localisedString.HNLOC_DASH_TOOLTIP_FAVORIS),"ephemeride"===type?widgets.getEphemeride(cacheWidget,type,"",newWidget,page,function(save){kendo.ui.progress($(currentLi).find(".contenu"),!1),0===newWidget.find("#prenoms >p").length&&(newWidget.find(".prenomsContainer").remove(),newWidget.find(".ephContent").css("height","250px")),0===newWidget.find("#dictons >p").length&&(newWidget.find(".dictonsContainer").remove(),newWidget.find(".ephContent").css("height","250px")),0===newWidget.find("#prenoms").length&&0===newWidget.find("#dictons").length&&0===newWidget.find(".stats").length&&(newWidget.html('<div class="defautViewKendo">'+localisedString.HNLOC_DASH_WIDGETS_NODATA_AVAILABLE+"</div>"),newWidget.find(".defautViewKendo").css("height","380px")),save&&uploadCache("data_ephemeride",self.getIdFile(),self.getPort(),JSON.stringify(cacheWidget.ephemeride),function(){console.log("cache de ephemeride   sauvegardÃ© avec succes  ")})}):"individus"===type||"progression"===type||"sources"===type||"media"===type||"naissanceDeces"===type||"patronymesPrenomsCourants"===type||"union"===type||"recensement"===type||"denombrement"===type||"tabGenSimple"===type||"difference"===type||"origines"===type?widgets.getWSWithGraph(index,type,data,newWidget,page,titre,haveDetail,callback,function(){if("denombrement"===type&&newWidget.find(".stats > .total > .statsValue > a").click(function(){eventHandler.ouvrirFicheIndividu(newWidget.find(".stats > .total > .statsValue > a"),type)}),void 0!==newWidget.find(".miniature").data("kendoChart")){if("patronymesPrenomsCourants"!==type&&"origines"!==type||("origines"===type&&newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+'#= value # (#= kendo.format("{0:P}", percentage) #)'}}),newWidget.find(".miniature").data("kendoChart").options.series[0].labels.visible=!1,newWidget.find(".miniature").data("kendoChart").options.series[0].holeSize=70,newWidget.find(".miniature").data("kendoChart").options.legend.orientation="horizontal",newWidget.find(".miniature").data("kendoChart").options.legend.labels.template="#= text #",newWidget.find(".miniature").data("kendoChart").refresh()),"naissanceDeces"===type||"union"===type||"recensement"===type||"denombrement"===type||"difference"===type||"progression"===type){if("union"===type)newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+' #= kendo.toString(value, "n1")  # '+localisedString.HNLOC_DASH_STATS_YEAR_PLURIEL}});else if("difference"===type)newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+' #= kendo.toString(value, "n1")  # '+localisedString.HNLOC_DASH_STATS_YEAR_PLURIEL}});else if(("denombrement"===type||"naissanceDeces"===type||"progression"===type)&&(newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:'#= kendo.toString(value, "n0")# #= dataItem.tooltip #'}}),"progression"===type&&(newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:'#= kendo.toString(value, "n0")# #= dataItem.tooltip #'}}),newWidget.find(".miniature").data("kendoChart").setOptions({legend:{position:"right"}})),"denombrement"===type)){for(var valuesTrouves=[],valuesDistincts=[],i=0;i<newWidget.find(".miniature").data("kendoChart").options.series[0].data.length;i++)valuesTrouves.push(newWidget.find(".miniature").data("kendoChart").options.series[0].data[i].value);for(i=0;i<newWidget.find(".miniature").data("kendoChart").options.series[1].data.length;i++)valuesDistincts.push(newWidget.find(".miniature").data("kendoChart").options.series[1].data[i].value);valuesTrouves.sort(function(a,b){return a-b}),valuesDistincts.sort(function(a,b){return a-b}),valuesTrouves[valuesTrouves.length-1]-valuesDistincts[valuesDistincts.length-1]>1e4&&(newWidget.find(".miniature").data("kendoChart").setOptions({valueAxes:[{name:"distincts",title:{text:localisedString.HNLOC_DASH_TITLE_TAB_DISTINCTS_MAJ_PLURIEL},labels:{rotation:"auto",font:"10px sans-serif"}},{name:"trouves",title:{text:localisedString.HNLOC_DASH_TITLE_TAB_TROUVES_MAJ_PLURIEL},labels:{rotation:"auto",font:"10px sans-serif",template:function(a){return a.value%1e9==0&&0!==a.value?a.value/1e9+"G":a.value%1e6==0&&0!==a.value?a.value/1e6+"M":a.value%1e3==0&&0!==a.value?a.value/1e3+"k":a.value}}}],categoryAxis:{axisCrossingValues:[0,2e3]}}),newWidget.find(".miniature").data("kendoChart").options.legend.reverse=!0,newWidget.find(".miniature").data("kendoChart").options.series[0].axis="trouves",newWidget.find(".miniature").data("kendoChart").refresh())}newWidget.find(".miniature").data("kendoChart").options.zoomable.mousewheel=!1,newWidget.find(".miniature").data("kendoChart").refresh()}if("tabGenSimple"===type)self.getCurrentPortee()===localisedString.HNLOC_DASH_FILTRE_DESCENDANCE&&newWidget.find(".miniature").data("kendoChart").dataSource.filter({field:"type",operator:"neq",value:localisedString.HNLOC_DASH_TABGEN_RESEARCH_HINT}),newWidget.find(".miniature").data("kendoChart").setOptions({tooltip:{template:"#=dataItem.tooltipValue#"}}),newWidget.find(".miniature").data("kendoChart").setOptions({seriesDefaults:{type:"bar"}}),newWidget.find(".miniature").data("kendoChart").setOptions({valueAxis:{max:100,labels:{template:"#= value #%"}}}),newWidget.find(".miniature").data("kendoChart").options.zoomable.mousewheel=!1,newWidget.find(".miniature").data("kendoChart").refresh();0===newWidget.find(".stats").length&&(newWidget.find(".miniature").data("kendoChart").options.chartArea.height=380,newWidget.find(".miniature").data("kendoChart").refresh())}"sources"===type?eventHandler.ouvrirDicoSourceAction(currentLi):"media"===type&&eventHandler.ouvrirDicoMediaAction(currentLi),"echosDuJour"!==page&&kendo.ui.progress($(currentLi).find(".contenu"),!1),0===newWidget.find(".stats").length&&newWidget.find(".defautViewKendo").css("height","380px")}):"evenements"===type?widgets.getCompteurs(index,type,data,newWidget,page,titre,haveDetail,callback,function(){kendo.ui.progress($(currentLi).find(".contenu"),!1)}):"nuageNom"===type||"nuagePrenom"===type||"nuageProfession"===type?widgets.getCloudWord(index,type,data,newWidget,page,titre,haveDetail,callback,function(){"nuageNom"===indexDetails?eventHandler.ouvrirDicoNomAction(currentLi):"nuagePrenom"===indexDetails?eventHandler.ouvrirDicoPrenomAction(currentLi):"nuageProfession"===indexDetails&&eventHandler.ouvrirDicoProfessionAction(currentLi),""!==page&&eventHandler.detailNuage(newWidget,indexDetails),kendo.ui.progress($(currentLi).find(".contenu"),!1)}):"lieux"===type?widgets.getLieux(index,type,data,newWidget,page,titre,haveDetail,callback,function(){0!==newWidget.find(".stats").length||newWidget.hasClass("pourcentageLGEO")||(newWidget.data("kendoChart").setOptions({chartArea:{height:380}}),newWidget.data("kendoChart").setOptions({title:{margin:{bottom:20}}})),eventHandler.ouvrirDicoLieuxAction(currentLi),""!==page&&eventHandler.detailNuage(newWidget,indexDetails),kendo.ui.progress($(currentLi).find(".contenu"),!1)}):"hol"===type&&widgets.getHOL(index,type,data,newWidget,haveDetail,function(){kendo.ui.progress($(currentLi).find(".contenu"),!1),newWidget.find(".contenuInfoFichier > table  a").css("color","black"),"en"===language&&($(newWidget).find(".Splus").hide(),$(newWidget).find(".SplusSection").hide(),$(newWidget).find(".sauvInfo").hide()),$(newWidget).find(".holConnect").click(function(){idProcessHOL=setInterval(function(){isConnectedHOL(idProcessHOL,idFile,port,function(){self.refresh()})},1e3),eventHandler.connectHOL(function(){})}),0!==newWidget.find(".saveLink").length&&newWidget.find(".saveLink").click(function(){eventHandler.saveFileHOL()}),0!==newWidget.find(".publishLink").length&&newWidget.find(".publishLink").click(function(){eventHandler.publishFileHOL()})})},InfosDetaille=function(type,data,context,titre,index){"grid"===type?widgets.getKendoGrid("",type,data,context,"",titre,"false",!0,function(){kendo.ui.progress($(context),!1),titre!==localisedString.HNLOC_DASH_LONGEVITE_TITLE&&titre!==localisedString.HNLOC_DASH_AGE_FIRST_UNION&&titre!==localisedString.HNLOC_DASH_DENOMBREMENT_denombrementDesc_TITLE&&titre!==localisedString.HNLOC_DASH_DENOMBREMENT_denombrementAsc_TITLE&&titre!==localisedString.HNLOC_DASH_RECENSEMENT_recensement_TITLE&&titre!==localisedString.HNLOC_DASH_NOMS_TITLE_PLURIEL&&titre!==localisedString.HNLOC_DASH_PRENOMS_TITLE_PLURIEL&&titre!==localisedString.HNLOC_DASH_ORIGINE_pays_TITLE&&titre!==localisedString.HNLOC_DASH_ORIGINE_region_TITLE&&titre!==localisedString.HNLOC_DASH_ORIGINE_departement_TITLE&&titre!==localisedString.HNLOC_DASH_PROGRESS_TAB_add_PLURIEL||($(context).data("kendoGrid").dataSource.pageSize(5),$(context).data("kendoGrid").refresh())}):($(context).append("<div></div>"),widgets.getKendoChart("",type,data,$(context).find(" > div"),"",titre,"false",!0,function(){if(kendo.ui.progress($(context),!1),"panel"===type&&($(context).find(".tableauDetail").kendoPanelBar({expandMode:"multiple",resizable:!0}),$(context).find(".tableauDetail").data("kendoPanelBar").expand($(".k-item"),!0),$(context).find("ul").data("kendoPanelBar").bind("select",function(e){void 0!==$(e.item).data("infoid")&&eventHandler.ouvrirFicheIndividu(e.item,index)}),"hol"===titre&&($(context).find("ul").removeClass("page-break"),$(context).find("div").last().remove(),"en"===language&&($(context).find(".SplusDetailSection").hide(),$(context).find(".SplusDetailDefaultMsg").hide(),$(context).parent().hasClass("sauvLi")&&$(context).hide()),0!==$(context).find(".saveLink").length&&$(context).find(".saveLink").click(function(){eventHandler.saveFileHOL()}),0!==$(context).find(".publishLink").length&&$(context).find(".publishLink").click(function(){eventHandler.publishFileHOL()}),0!==$(context).find(".publishLInk").length&&$(context).find(".publishLInk").click(function(){eventHandler.publishFileHOL()}),$(context).find("ul").data("kendoPanelBar").collapse($(".listPhotos")),$(context).find("ul").data("kendoPanelBar").bind("expand",function(e){void 0!==$(e.item).data("urlalbum")&&eventHandler.getAlbums($(e.item).data("urlalbum"),function(res){if(0===$(e.item).find("ul >li").length)for(var i=0;i<res.nbPhotos;i++)$(e.item).find("ul").append("<li><div>"+res.photos[i].date+"</div><div>"+res.photos[i].infos+'</div><div class="apercuPhotoAlbum"><a target="_blank" href="'+res.photos[i].url+'"><img src="'+res.photos[i].imgUrl+'"></a></div></li>')})}),"sauvegarde"===index&&widgets.getProgressBar(context,data))),void 0!==$(context).find(">div").data("kendoChart")){if(titre===localisedString.HNLOC_DASH_AGE_FIRST_UNION)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+'#= kendo.toString(value, "n1")  # '+localisedString.HNLOC_DASH_STATS_YEAR_PLURIEL}});else if(titre===localisedString.HNLOC_DASH_DIFFAGE_differenceageConjoint_TITLE||titre===localisedString.HNLOC_DASH_DIFFAGE_differenceageAineBenj_TITLE)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+'#= kendo.toString(value, "n1")  # '+localisedString.HNLOC_DASH_STATS_YEAR_PLURIEL}});else if(titre===localisedString.HNLOC_DASH_ORIGINE_pays_TITLE||titre===localisedString.HNLOC_DASH_ORIGINE_region_TITLE||titre===localisedString.HNLOC_DASH_ORIGINE_departement_TITLE)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+'#= value # (#= kendo.format("{0:P}", percentage) #)'}}),$(context).find(">div").data("kendoChart").options.series[0].labels.template="#= category #"+localisedString.HNLOC_2_POINTS+'#= value # (#= kendo.format("{0:P}", percentage) #)';else if(titre===localisedString.HNLOC_DASH_PERCENT_MAMWOMAN_TITLE)$(context).find(">div").data("kendoChart").options.legend.labels.template="#= dataItem.legend # ";else if(titre===localisedString.HNLOC_DASH_NB_EFT_UNION)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#= category # "+localisedString.HNLOC_2_POINTS+'#= kendo.toString(value, "n1")  # '+localisedString.HNLOC_DASH_STATS_CHILDREN}});else if(titre===localisedString.HNLOC_DASH_MARIAGE)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#= category #"+localisedString.HNLOC_2_POINTS+"#= value  # "+localisedString.HNLOC_DASH_STATS_UNION}});else if(titre===localisedString.HNLOC_DASH_LONGEVITE_TITLE)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:"#=  category  # "+localisedString.HNLOC_2_POINTS+'#= kendo.toString(value, "n1") # '+localisedString.HNLOC_DASH_STATS_YEAR_PLURIEL}});else if(titre===localisedString.HNLOC_DASH_BAR_COMPLETION_TITLE)$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:'#= value # #= dataItem.tooltip.indi # #= kendo.format("{0:P}",percentage)#<br/> '+localisedString.HNLOC_DASH_FILEINFO_WITH+" #=dataItem.niveauCompletionEvt# #= dataItem.tooltip.evt # "}}),$(context).find(">div").data("kendoChart").options.series[0].labels.template="#= value # #= dataItem.tooltip.indi # "+localisedString.HNLOC_2_PARENTHESE_OUVRANTE+"#= kendo.format('{0:P}',percentage)#"+localisedString.HNLOC_2_PARENTHESE_FERMANTE;else if(titre===localisedString.HNLOC_DASH_PROGRESS_IDVCREATED_TITLE)$(context).find(">div").data("kendoChart").setOptions({dataSource:{data:data[0],group:[{field:"type",dir:"asc"}],sort:{field:"index",dir:"asc"}}}),$(context).find(">div").data("kendoChart").setOptions({tooltip:{template:'#= kendo.toString(value, "n0")# #= dataItem.tooltip #'}});else if((titre===localisedString.HNLOC_DASH_DECES_TITLE||titre===localisedString.HNLOC_DASH_RECENSEMENT_recensement_TITLE||titre===localisedString.HNLOC_DASH_DENOMBREMENT_denombrementDesc_TITLE||titre===localisedString.HNLOC_DASH_DENOMBREMENT_denombrementAsc_TITLE||titre===localisedString.HNLOC_DASH_NAISSANCEDECES_NaissanceDeces_LABEL||titre===localisedString.HNLOC_DASH_PROGRESS_IDVCREATED_TITLE)&&($(context).find(">div").data("kendoChart").setOptions({tooltip:{template:'#= kendo.toString(value, "n0")# #= dataItem.tooltip #'}}),titre===localisedString.HNLOC_DASH_DENOMBREMENT_denombrementDesc_TITLE||titre===localisedString.HNLOC_DASH_DENOMBREMENT_denombrementAsc_TITLE)){for(var valuesTrouves=[],valuesDistincts=[],i=0;i<$(context).find(">div").data("kendoChart").options.series[0].data.length;i++)valuesTrouves.push($(context).find(">div").data("kendoChart").options.series[0].data[i].value);for(i=0;i<$(context).find(">div").data("kendoChart").options.series[1].data.length;i++)valuesDistincts.push($(context).find(">div").data("kendoChart").options.series[1].data[i].value);valuesTrouves.sort(function(a,b){return a-b}),valuesDistincts.sort(function(a,b){return a-b}),valuesTrouves[valuesTrouves.length-1]-valuesDistincts[valuesDistincts.length-1]>1e4&&($(context).find(">div").data("kendoChart").setOptions({valueAxes:[{name:"distincts",title:{text:localisedString.HNLOC_DASH_TITLE_TAB_DISTINCTS_MAJ_PLURIEL},labels:{rotation:"auto",font:"10px sans-serif",template:'#= kendo.toString(value, "n0")#'}},{name:"trouves",title:{text:localisedString.HNLOC_DASH_TITLE_TAB_TROUVES_MAJ_PLURIEL},labels:{rotation:"auto",font:"10px sans-serif",template:'#= kendo.toString(value, "n0")#'}}],categoryAxis:{axisCrossingValues:[0,2e3]}}),$(context).find(">div").data("kendoChart").options.legend.reverse=!0,$(context).find(">div").data("kendoChart").options.series[0].axis="trouves",$(context).find(">div").data("kendoChart").refresh())}$(context).resize()}}))};this.getVueDetailleWidget=function(index,context,callback,formatDate,pad,sexe){$(context).find(".pdf").empty(),$(context).find(".pdf").html('<img><span class="k-icon k-i-pdf"></img>');var mapIntervalValue={},mapSexe={},mapTypeAffichage={};void 0!==filtre[index].sexe&&void 0===sexe?sexe=filtre[index].sexe:void 0===sexe?void 0===filtre[index].sexe&&(sexe=localisedString.HNLOC_DASH_ALL,filtre[index].sexe=localisedString.HNLOC_DASH_ALL):filtre[index].sexe=sexe,void 0!==filtre[index].formatDate&&void 0===formatDate?formatDate=filtre[index].formatDate:void 0===formatDate?void 0===filtre[index].formatDate&&(formatDate=localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_DATE,filtre[index].formatDate=localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_DATE):filtre[index].formatDate=formatDate,void 0!==filtre[index].pad&&void 0===pad?pad=filtre[index].pad:void 0===pad?void 0===filtre[index].pad&&(pad=localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_50,filtre[index].pad=localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_50):filtre[index].pad=pad,localStorage.setItem("filtre",JSON.stringify(filtre)),self.uploadCache("paramsDhb"),(lastDetailCall={}).index=index,lastDetailCall.context=context,lastDetailCall.callback=callback,lastDetailCall.formatDate=formatDate,lastDetailCall.pad=pad,lastDetailCall.sexe=sexe,mapIntervalValue[localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_5]=5,mapIntervalValue[localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_10]=10,mapIntervalValue[localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_20]=20,mapIntervalValue[localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_50]=50,mapIntervalValue[localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_100]=100,mapSexe[localisedString.HNLOC_DASH_STATS_HOMME_MAJ_PLURIEL]="h",mapSexe[localisedString.HNLOC_DASH_STATS_FEMME_MAJ_PLURIEL]="f",mapSexe[localisedString.HNLOC_DASH_ALL]="all",mapTypeAffichage[localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_DATE]="periode",mapTypeAffichage[localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_MOIS]="mois",$(context).find(".addToHomePage").css("display","none");var tmp=$(context).find(".contenu> div> .stats");0===$(context).find(".optionsGraphSelect").length&&($(context).find(".contenu").html(vueDetailleWidgetStats),$(context).find(".optionsGraph .valider").html(localisedString.HNLOC_DASH_OPTIONS_SUBMIT_LABEL),$(context).find(".formatDate > .label").html(localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_LABEL),$(context).find(".formatDate > .formatValues").html("<option>"+localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_DATE+"</option><option>"+localisedString.HNLOC_DASH_STATS_TYPE_AFFICHAGE_MOIS+"</option>"),$(context).find(".intervalDate > .label").html(localisedString.HNLOC_DASH_STATS_INTERVAL_LABEL),$(context).find(".intervalDate > .padValues").html("<option>"+localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_5+"</option><option>"+localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_10+"</option><option>"+localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_20+"</option><option>"+localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_50+"</option><option>"+localisedString.HNLOC_DASH_STATS_INTERVAL_ANNEE_100+"</option>"),$(context).find(".sexe > .label").html(localisedString.HNLOC_DASH_LABEL_H_F_T),$(context).find(".sexe > .sexeValues").html("<option >"+localisedString.HNLOC_DASH_ALL+"</option><option >"+localisedString.HNLOC_DASH_STATS_HOMME_MAJ_PLURIEL+"</option><option>"+localisedString.HNLOC_DASH_STATS_FEMME_MAJ_PLURIEL+"</option>"),$(context).find(".contenu .stats").html(tmp),$(context).find(".formatValues").kendoDropDownList().data("kendoDropDownList").text(formatDate),$(context).find(".padValues").kendoDropDownList().data("kendoDropDownList").text(pad),$(context).find(".sexeValues").kendoDropDownList().data("kendoDropDownList").text(sexe));var interval=mapIntervalValue[pad],sexeValue=mapSexe[sexe],typeAffichage=mapTypeAffichage[formatDate];if($(context).find(".optionsGraph").hide(),$(context).find(".contenu > ul").empty(),"evenements"===index){$(context).find(".optionsGraph").remove();var nodeNul="<li></li>";downloadCache("data_evenements",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.evenements,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.evenements=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getStatsEvenements(cacheWidget,"evenements","page",currentPeriode,"titre",idFile,port,function(){var TotalEvt=$(context).find(".stats > .stats > div")[0];$(context).find(".stats").html('<div class="stats"></div>'),$(TotalEvt).find(".statsValue").html(cacheWidget.evenements.total),$(context).find(".stats > .stats").html(TotalEvt)},nodeNul)});var ulDetail=$(context).find(".contenu ul");$(ulDetail).append("<li>");var liDetailEvt=$(ulDetail).find("li").last();$(liDetailEvt).css("min-height","400px"),$(liDetailEvt).css("position","relative"),downloadCache("data_detailEvt",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.evenements,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.detailEvt=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDetailEvt(cacheWidget,"panel",liDetailEvt,"evenements",idFile,port,InfosDetaille)})}else if("individus"===index){$(context).find(".optionsGraph").remove();ulDetail=$(context).find(".contenu ul"),nodeNul="<li></li>";downloadCache("data_individus",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.individus,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.individus=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getNbIndivSosas(cacheWidget,"individus","page",currentPeriode,"titre",idFile,port,function(){$(context).find(".ajoutRecent >.statsValue").html(cacheWidget.individus.ajoutRecent[currentPeriode]),$(context).find(".total >.statsValue").html(cacheWidget.individus.compteurs)},nodeNul)}),$(ulDetail).append("<li>");var liDetailPercentManWoman=$(ulDetail).find("li").last();$(liDetailPercentManWoman).css("min-height","400px"),$(liDetailPercentManWoman).css("position","relative"),$(ulDetail).append("<li>");var liDetailCompletionFile=$(ulDetail).find("li").last();$(liDetailCompletionFile).css("min-height","400px"),$(liDetailCompletionFile).css("position","relative"),$(ulDetail).append("<li>");var liDetailDetailIndiTab=$(ulDetail).find("li").last();$(liDetailDetailIndiTab).css("min-height","400px"),$(liDetailDetailIndiTab).css("position","relative"),downloadCache("data_percentManWoman",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.percentManWoman,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.percentManWoman=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getPercentManWoman(cacheWidget,"donut",liDetailPercentManWoman,localisedString.HNLOC_DASH_PERCENT_MAMWOMAN_TITLE,idFile,port,InfosDetaille)}),downloadCache("data_avancement",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.avancement,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.avancement=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getCompletionFile(cacheWidget,"donut",liDetailCompletionFile,localisedString.HNLOC_DASH_BAR_COMPLETION_TITLE,idFile,port,InfosDetaille)}),downloadCache("data_detailIndiTab",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.detailIndiTab,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.detailIndiTab=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDetailIndiTab(cacheWidget,"panel",liDetailDetailIndiTab,"",idFile,port,InfosDetaille)})}else if("progression"===index){$(context).find(".optionsGraph").remove();ulDetail=$(context).find(".contenu ul");$(ulDetail).append("<li>");var IdvProgDetailDynamicGraph=$(ulDetail).find("li").last();$(IdvProgDetailDynamicGraph).css("min-height","400px"),$(IdvProgDetailDynamicGraph).css("position","relative"),$(ulDetail).append("<li>");var IdvProgDetailStaticGraph=$(ulDetail).find("li").last();$(IdvProgDetailStaticGraph).css("min-height","400px"),$(IdvProgDetailStaticGraph).css("position","relative"),$(ulDetail).append("<li>");var IdvCreatedtabContainer=$(context).find("li").last();$(IdvCreatedtabContainer).css("min-height","400px"),$(IdvCreatedtabContainer).css("position","relative"),downloadCache("data_progression_yearly",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.progression_yearly,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.progression_yearly=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getIdvCreatedProgression(cacheWidget,IdvProgDetailDynamicGraph,localisedString.HNLOC_DASH_PROGRESS_IDVCREATED_TITLE,idFile,port,InfosDetaille,"yearly")}),downloadCache("data_progression_static",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.progression_static,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.progression_static=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getIdvCreatedProgression(cacheWidget,IdvProgDetailStaticGraph,localisedString.HNLOC_DASH_PROGRESS_IDVCREATED_TITLE,idFile,port,InfosDetaille,"static")}),downloadCache("data_IdvCreatedModified",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.IdvCreatedModified,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.IdvCreatedModified=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getIdvCreatedModified(cacheWidget,"panel",IdvCreatedtabContainer,"",idFile,port,InfosDetaille)})}else if("hol"===index){$(context).find(".optionsGraph").remove();var cacheHol=JSON.parse(localStorage.getItem("detailHol"));null!==cacheHol&&(cacheWidget.detailHol=cacheHol),getDetailHOL(cacheWidget,$(context).find(".contenu ul"),"hol",idFile,port,InfosDetaille,function(){self.redirects(page)})}else if("patronymesPrenomsCourants"===index){$(context).find(".optionsGraph").show(),$(context).find(".formatDate").remove(),$(context).find(".intervalDate").remove();ulDetail=$(context).find(".contenu ul");var patronymesCourantsConteneur=[];$(ulDetail).append("<li>");var liPatronymesCourantsGraph=$(ulDetail).find("li").last();$(liPatronymesCourantsGraph).css("min-height","400px"),$(liPatronymesCourantsGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var PatronymesCourantstabContainer=$(context).find("li").last().find("div");PatronymesCourantstabContainer.toggleClass("tableauStats"),$(PatronymesCourantstabContainer).css("min-height","400px"),$(PatronymesCourantstabContainer).css("position","relative"),patronymesCourantsConteneur.push(liPatronymesCourantsGraph),patronymesCourantsConteneur.push(PatronymesCourantstabContainer);var prenomsCourantsConteneur=[];$(ulDetail).append("<li>");var liPrenomsCourantsGraph=$(ulDetail).find("li").last();$(liPrenomsCourantsGraph).css("min-height","400px"),$(liPrenomsCourantsGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var liPrenomsCourantstabContainer=$(context).find("li").last().find("div");liPrenomsCourantstabContainer.toggleClass("tableauStats"),$(liPrenomsCourantstabContainer).css("min-height","400px"),$(liPrenomsCourantstabContainer).css("position","relative"),prenomsCourantsConteneur.push(liPrenomsCourantsGraph),prenomsCourantsConteneur.push(liPrenomsCourantstabContainer),downloadCache("data_prenoms",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.prenoms,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.prenoms=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getPrenomsCourants(cacheWidget,prenomsCourantsConteneur,localisedString.HNLOC_DASH_PRENOMS_TITLE_PLURIEL,idFile,port,InfosDetaille,sexeValue)}),downloadCache("data_patronymes",self.getIdFile(),self.getPort(),function(data){if(""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.patronymes=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getPatronymesCourants(cacheWidget,patronymesCourantsConteneur,localisedString.HNLOC_DASH_NOMS_TITLE_PLURIEL,idFile,port,InfosDetaille,sexeValue)})}else if("origines"===index){var hr=$(context).data("lien");$(context).find(".optionsGraph").remove();ulDetail=$(context).find(".contenu ul");var PaysConteneur=[];$(ulDetail).append("<li>");var liPaysGraph=$(ulDetail).find("li").last();$(liPaysGraph).css("min-height","400px"),$(liPaysGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var PaystabContainer=$(context).find("li").last().find("div");PaystabContainer.toggleClass("tableauStats"),$(PaystabContainer).css("min-height","400px"),$(PaystabContainer).css("position","relative"),PaysConteneur.push(liPaysGraph),PaysConteneur.push(PaystabContainer);var RegionConteneur=[];$(ulDetail).append("<li id='region'>");var liRegionGraph=$(ulDetail).find("li").last();$(liRegionGraph).css("min-height","400px"),$(liRegionGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var RegiontabContainer=$(context).find("li").last().find("div");RegiontabContainer.toggleClass("tableauStats"),$(RegiontabContainer).css("min-height","400px"),$(RegiontabContainer).css("position","relative"),RegionConteneur.push(liRegionGraph),RegionConteneur.push(RegiontabContainer);var DepartementConteneur=[];$(ulDetail).append("<li id='departement'>");var liDepartementGraph=$(ulDetail).find("li").last();$(liDepartementGraph).css("min-height","400px"),$(liDepartementGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var DepartementtabContainer=$(context).find("li").last().find("div");DepartementtabContainer.toggleClass("tableauStats"),$(DepartementtabContainer).css("min-height","400px"),$(DepartementtabContainer).css("position","relative"),DepartementConteneur.push(liDepartementGraph),DepartementConteneur.push(DepartementtabContainer),downloadCache("data_repartitionPays",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.repartitionPays,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.repartitionPays=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getRepartition(cacheWidget,PaysConteneur,localisedString.HNLOC_DASH_ORIGINE_pays_TITLE,idFile,port,InfosDetaille,"country")}),downloadCache("data_repartitionRegion",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.repartitionRegion,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.repartitionRegion=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getRepartition(cacheWidget,RegionConteneur,localisedString.HNLOC_DASH_ORIGINE_region_TITLE,idFile,port,InfosDetaille,"region")}),downloadCache("data_repartitionDepartement",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.repartitionDepartement,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.repartitionDepartement=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getRepartition(cacheWidget,DepartementConteneur,localisedString.HNLOC_DASH_ORIGINE_departement_TITLE,idFile,port,InfosDetaille,"department")}),""!=hr&&($(document).ready(function(){$(ulDetail).ready(setTimeout(function(){$("html,body").animate({scrollTop:$("#"+hr).offset().top-80},1500)},1e3))}),$(context).data("lien",""))}else if("naissanceDeces"===index){$(context).find(".optionsGraph").show(),$(context).find(".sexe").remove();ulDetail=$(context).find(".contenu ul");var naissanceDecesDetailConteneur=[];$(ulDetail).append("<li>");var linaissanceDecesDetailGraph=$(ulDetail).find("li").last();$(linaissanceDecesDetailGraph).css("min-height","400px"),$(linaissanceDecesDetailGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var naissanceDecesDetailtabContainer=$(context).find("li").last().find("div");naissanceDecesDetailtabContainer.toggleClass("tableauStats"),$(naissanceDecesDetailtabContainer).css("min-height","400px"),$(naissanceDecesDetailtabContainer).css("position","relative"),naissanceDecesDetailConteneur.push(linaissanceDecesDetailGraph),naissanceDecesDetailConteneur.push(naissanceDecesDetailtabContainer);var DecesConteneur=[];$(ulDetail).append("<li>");var lidecesGraph=$(ulDetail).find("li").last();$(lidecesGraph).css("min-height","400px"),$(lidecesGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var DecestabContainer=$(context).find("li").last().find("div");DecestabContainer.toggleClass("tableauStats"),$(DecestabContainer).css("min-height","400px"),$(DecestabContainer).css("position","relative"),DecesConteneur.push(lidecesGraph),DecesConteneur.push(DecestabContainer);var longeviteConteneur=[];$(ulDetail).append("<li>");var lilongeviteGraph=$(ulDetail).find("li").last();$(lilongeviteGraph).css("min-height","400px"),$(lilongeviteGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var longevitetabContainer=$(context).find("li").last().find("div");longevitetabContainer.toggleClass("tableauStats"),$(longevitetabContainer).css("min-height","400px"),$(longevitetabContainer).css("position","relative"),longeviteConteneur.push(lilongeviteGraph),longeviteConteneur.push(longevitetabContainer);var rencensementConteneur=[];$(ulDetail).append("<li>");var lirecensementGraph=$(ulDetail).find("li").last();$(lirecensementGraph).css("min-height","400px"),$(lirecensementGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var recensementtabContainer=$(context).find("li").last().find("div");recensementtabContainer.toggleClass("tableauStats"),$(recensementtabContainer).css("min-height","400px"),$(recensementtabContainer).css("position","relative"),rencensementConteneur.push(lirecensementGraph),rencensementConteneur.push(recensementtabContainer),downloadCache("data_naissanceDecesDetail",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.naissanceDecesDetail,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.naissanceDecesDetail=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getNaissanceDecesDetail(cacheWidget,naissanceDecesDetailConteneur,localisedString.HNLOC_DASH_NAISSANCEDECES_NaissanceDeces_LABEL,idFile,port,InfosDetaille,interval,typeAffichage)}),downloadCache("data_deces",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.deces,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.deces=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDeces(cacheWidget,DecesConteneur,localisedString.HNLOC_DASH_DECES_TITLE,idFile,port,InfosDetaille)}),downloadCache("data_longevite",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.longevite,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.longevite=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getLongevite(cacheWidget,longeviteConteneur,localisedString.HNLOC_DASH_LONGEVITE_TITLE,idFile,port,InfosDetaille,interval,typeAffichage)}),downloadCache("data_recensement",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.recensement,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.recensement=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getRecensementDetail(cacheWidget,rencensementConteneur,localisedString.HNLOC_DASH_RECENSEMENT_recensement_TITLE,idFile,port,InfosDetaille,interval,typeAffichage)})}else if("union"===index){$(context).find(".optionsGraph").show(),$(context).find(".sexe").remove();ulDetail=$(context).find(".contenu ul");var moyenneAgeUnionConteneur=[];$(ulDetail).append("<li>");var limoyenneAgeUnionGraph=$(ulDetail).find("li").last();$(limoyenneAgeUnionGraph).css("min-height","400px"),$(limoyenneAgeUnionGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var moyenneAgeUniontabContainer=$(context).find("li").last().find("div");moyenneAgeUniontabContainer.toggleClass("tableauStats"),$(moyenneAgeUniontabContainer).css("min-height","400px"),$(moyenneAgeUniontabContainer).css("position","relative"),moyenneAgeUnionConteneur.push(limoyenneAgeUnionGraph),moyenneAgeUnionConteneur.push(moyenneAgeUniontabContainer);var nbEnfantsUnionConteneur=[];$(ulDetail).append("<li>");var linbEnfantsUnionGraph=$(ulDetail).find("li").last();$(linbEnfantsUnionGraph).css("min-height","400px"),$(linbEnfantsUnionGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var nbEnfantsUniontabContainer=$(context).find("li").last().find("div");nbEnfantsUniontabContainer.toggleClass("tableauStats"),$(nbEnfantsUniontabContainer).css("min-height","400px"),$(nbEnfantsUniontabContainer).css("position","relative"),nbEnfantsUnionConteneur.push(linbEnfantsUnionGraph),nbEnfantsUnionConteneur.push(nbEnfantsUniontabContainer);var mariageConteneur=[];$(ulDetail).append("<li>");var limariageGraph=$(ulDetail).find("li").last();$(limariageGraph).css("min-height","400px"),$(limariageGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var mariagetabContainer=$(context).find("li").last().find("div");mariagetabContainer.toggleClass("tableauStats"),$(mariagetabContainer).css("min-height","400px"),$(mariagetabContainer).css("position","relative"),mariageConteneur.push(limariageGraph),mariageConteneur.push(mariagetabContainer),downloadCache("data_moyenneAgeUnion",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.moyenneAgeUnion,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.moyenneAgeUnion=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getMoyenneAgeUnion(cacheWidget,moyenneAgeUnionConteneur,localisedString.HNLOC_DASH_AGE_FIRST_UNION,idFile,port,InfosDetaille,interval)}),downloadCache("data_nbEnfantsUnion",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.nbEnfantsUnion,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.nbEnfantsUnion=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getNbEnfantsUnion(cacheWidget,nbEnfantsUnionConteneur,localisedString.HNLOC_DASH_NB_EFT_UNION,idFile,port,InfosDetaille,interval)}),downloadCache("data_mariage",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.mariage,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.mariage=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getMariage(cacheWidget,mariageConteneur,localisedString.HNLOC_DASH_MARIAGE,idFile,port,InfosDetaille,interval,typeAffichage)})}else if("difference"===index){$(context).find(".optionsGraph").show(),$(context).find(".formatDate").remove(),$(context).find(".sexe").remove();ulDetail=$(context).find(".contenu ul");var diffAgeUnionConteneur=[];$(ulDetail).append("<li>");var lidiffAgeUnionGraph=$(ulDetail).find("li").last();$(lidiffAgeUnionGraph).css("min-height","400px"),$(lidiffAgeUnionGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var diffAgeUniontabContainer=$(context).find("li").last().find("div");diffAgeUniontabContainer.toggleClass("tableauStats"),$(diffAgeUniontabContainer).css("min-height","400px"),$(diffAgeUniontabContainer).css("position","relative"),diffAgeUnionConteneur.push(lidiffAgeUnionGraph),diffAgeUnionConteneur.push(diffAgeUniontabContainer);var diffAgeChildrenConteneur=[];$(ulDetail).append("<li>");var lidiffAgeChildrenGraph=$(ulDetail).find("li").last();$(lidiffAgeChildrenGraph).css("min-height","400px"),$(lidiffAgeChildrenGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var diffAgeChildrentabContainer=$(context).find("li").last().find("div");diffAgeChildrentabContainer.toggleClass("tableauStats"),$(diffAgeChildrentabContainer).css("min-height","400px"),$(diffAgeChildrentabContainer).css("position","relative"),diffAgeChildrenConteneur.push(lidiffAgeChildrenGraph),diffAgeChildrenConteneur.push(diffAgeChildrentabContainer),downloadCache("data_diffAgeUnion",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.differenceConjoint,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.differenceConjoint=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDifferenceAgeConjoints(cacheWidget,diffAgeUnionConteneur,localisedString.HNLOC_DASH_DIFFAGE_differenceageConjoint_TITLE,idFile,port,InfosDetaille,interval)}),downloadCache("data_diffAgeChildren",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.diffAineBenjamin,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.diffAineBenjamin=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDifferenceAgeAineBenjamin(cacheWidget,diffAgeChildrenConteneur,localisedString.HNLOC_DASH_DIFFAGE_differenceageAineBenj_TITLE,idFile,port,InfosDetaille,interval)})}else if("denombrement"===index){$(context).find(".optionsGraph").remove(),$(context).find(".stats >div").show();nodeNul="<li></li>",ulDetail=$(context).find(".contenu ul");getDenombrement(cacheWidget,"","page","currentPeriode","titre",idFile,port,function(){$(context).find(".total > .statsValue").html('<a data-infoid="'+cacheWidget.denombrement.centralInfo.id+'">'+cacheWidget.denombrement.centralInfo.usualNames+"</a>"),$(context).find(".total > .statsValue > a").click(function(){eventHandler.ouvrirFicheIndividu($(context).find(".stats > .total > .statsValue > a"),index)})},nodeNul);var denombrementAscConteneur=[];$(ulDetail).append("<li>");var lidenombrementAscGraph=$(ulDetail).find("li").last();$(lidenombrementAscGraph).css("min-height","400px"),$(lidenombrementAscGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var denombrementAsctabContainer=$(context).find("li").last().find("div");denombrementAsctabContainer.toggleClass("tableauStats"),$(denombrementAsctabContainer).css("min-height","400px"),$(denombrementAsctabContainer).css("position","relative"),denombrementAscConteneur.push(lidenombrementAscGraph),denombrementAscConteneur.push(denombrementAsctabContainer);var denombrementDescConteneur=[];$(ulDetail).append("<li>");var lidenombrementDescGraph=$(ulDetail).find("li").last();$(lidenombrementDescGraph).css("min-height","400px"),$(lidenombrementDescGraph).css("position","relative"),$(ulDetail).append("<li><div></div></li>");var denombrementDesctabContainer=$(context).find("li").last().find("div");denombrementDesctabContainer.toggleClass("tableauStats"),$(denombrementDesctabContainer).css("min-height","400px"),$(denombrementDesctabContainer).css("position","relative"),denombrementDescConteneur.push(lidenombrementDescGraph),denombrementDescConteneur.push(denombrementDesctabContainer),downloadCache("data_denombrementAsc",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.denombrementAsc,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.denombrementAsc=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDenombrementAsc(cacheWidget,denombrementAscConteneur,localisedString.HNLOC_DASH_DENOMBREMENT_denombrementAsc_TITLE,idFile,port,InfosDetaille)}),downloadCache("data_denombrementDesc",self.getIdFile(),self.getPort(),function(data){if(delete cacheWidget.denombrementDesc,""!==data){var cachePorteeWidget=JSON.parse(data);void 0!==cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]&&Object.keys(cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]]).length>0&&(cacheWidget.denombrementDesc=cachePorteeWidget[mapPorteeValues[localStorage.getItem("portee")]])}getDenombrementDesc(cacheWidget,denombrementDescConteneur,localisedString.HNLOC_DASH_DENOMBREMENT_denombrementDesc_TITLE,idFile,port,InfosDetaille,interval,typeAffichage)})}else"tabGenSimple"===index?($("nav ul li").each(function(){"tabGen"===$(this).attr("id")?($(this).toggleClass("active"),$(this).css("color","rgb(128, 128, 128)")):($(this).removeClass("active"),$(this).css("color","rgb(255, 255, 255)"))}),self.redirects("tabGen")):$(context).find(".contenu").append("En cours de dÃ©veloppement");void 0!==callback&&callback()},this.getAllWidgets=function(callback){var pages=["infosFichiers","stats","echosDuJour"],window=$("#allWidgets"),contenu='<div id="container"><ul style="height:470px;"></ul><div class="footer"><button class="k-button" id="ajouter">'+localisedString.HNLOC_DASH_CHOIX_WIDGET_BUTTON_LABEL+"</button></div></div>";window.html(contenu);var allW,Allwidgets=[],total=(allW=[],"fr"===language&&allW.push("ephemeride"),allW.push("hol"),allW.push("individus"),allW.push("evenements"),allW.push("lieux"),allW.push("sources"),allW.push("nuageNom"),allW.push("nuagePrenom"),allW.push("nuageProfession"),allW.push("media"),allW.push("origines"),allW.push("union"),allW.push("denombrement"),allW.push("patronymesPrenomsCourants"),allW.push("difference"),allW.push("tabGenSimple"),allW.push("progression"),allW.push("naissanceDeces"),allW.length);widgetAccueil.length===total?$("#notification").kendoNotification({position:{top:"5%"}}).data("kendoNotification").show(localisedString.HNLOC_DASH_MSG_HOMEPAGE_FULL):window.data("kendoWindow")?(window.data("kendoWindow").open(),$("#allWidgets").parent().css("top","55px"),$("#allWidgets").parent().css("left","30%")):window.kendoWindow({width:"560px",minWidth:"560px",maxWidth:"560px",height:"600px",minHeight:"520px",maxHeight:"600px",title:localisedString.HNLOC_DASH_CHOIX_WIDGET_LABEL,modal:!0,close:function(){window.empty(),self.refresh()},open:function(){var widgets;Allwidgets=[];var widgetsAccueilNom=[];if(0!==widgetAccueil.length)for(var i=0;i<widgetAccueil.length;i++)widgetsAccueilNom.push(widgetAccueil[i][1]);for(i=0;i<pages.length;i++){var headerAlreadyExist=!1,callbackFillistAllWidgets=function(){for(var j=0;j<widgets.length;j++)-1===widgetsAccueilNom.indexOf(widgets[j][1])&&(headerAlreadyExist||(Allwidgets.push([pages[i]]),headerAlreadyExist=!0),widgets[j].push(pages[i]),widgets[j].push(j),Allwidgets.push(widgets[j]))};0===(widgets=getWidgetsOfPage(pages[i])).length?(widgets=getWidgetsOfPage(pages[i]),callbackFillistAllWidgets()):callbackFillistAllWidgets()}},activate:function(){refreshPageWidget("container",Allwidgets,"",function(){callback()})}}).data("kendoWindow").center().open()},this.updateWidgetList=function(prevPos,newPos){if(void 0!==prevPos&&void 0!==newPos){var widgetListPage;"accueil"===page?widgetListPage=widgetAccueil:"infosFichiers"===page?widgetListPage=widgetInfosFichiers:"stats"===page?widgetListPage=widgetStats:"echosDuJour"===page&&(widgetListPage=widgetEchosDuJour);var tmp=widgetListPage[prevPos];if(prevPos>newPos)for(var i=prevPos;i>=newPos;i--)widgetListPage[i]=widgetListPage[i-1];else if(prevPos<newPos)for(var j=Number(prevPos);j<=newPos;j++)widgetListPage[j]=widgetListPage[j+1];widgetListPage[newPos]=tmp,savePositionWidget(page)}self.uploadCache("paramsDhb")},this.removeWidgetAtIndex=function(pos){var type=widgetAccueil[pos][0],pageOfWidgetToDelete=mapFavoris[type];getWidgetsOfPage(pageOfWidgetToDelete,function(widgetPages){for(var i=0;i<widgetPages.length;i++)widgetPages[i][0]===widgetAccueil[pos][0]&&(widgetPages[i][4]=!1);widgetAccueil.splice(pos,1),delete mapFavoris[type],localStorage.setItem("favoris",JSON.stringify(mapFavoris)),savePositionWidget(pageOfWidgetToDelete),savePositionWidget(page,function(){self.refresh(),self.uploadCache("paramsDhb")})})},this.removeWidgetFromHomePage=function(item,type){for(var i=0;i<widgetAccueil.length;i++)widgetAccueil[i][0]===type&&widgetAccueil.splice(i,1),delete mapFavoris[type],localStorage.setItem("favoris",JSON.stringify(mapFavoris));setFavorisState(item[0],item[1],!1),savePositionWidget("accueil"),self.uploadCache("paramsDhb")},this.addWidgetsToHomepage=function(items){if(0!==items.length){for(var i=0;i<items.length;i++){var widgets=getWidgetsOfPage(items[i][0]);widgetAccueil.push(widgets[items[i][1]]),setFavorisState(items[i][0],items[i][1],!0),type=widgets[items[i][1]][0],page=items[i][0],mapFavoris[type]=page,localStorage.setItem("favoris",JSON.stringify(mapFavoris)),self.uploadCache("paramsDhb")}savePositionWidget("accueil")}var type,page;self.uploadCache("paramsDhb")};var refreshPageWidget=function(idContainer,widgetList,page,callback){if($("#"+idContainer+" >ul").empty(),0!==widgetList.length)for(var index,i=0;i<widgetList.length;i++)""===page?(index=[],widgetList[i].length>1?(index.push(widgetList[i][widgetList[i].length-2]),index.push(widgetList[i][widgetList[i].length-1]),initBlankWidget(widgetList[i][0],page,currentPeriode,widgetList[i][1],addWidget,this[widgetList[i][3]],widgetList[i][2],index,!1)):initBlankWidget(widgetList[i][0],"","","","","","",index,!1)):initBlankWidget(widgetList[i][0],page,currentPeriode,widgetList[i][1],"tabGen"===page?loadTabGen:addWidget,this[widgetList[i][3]],widgetList[i][2],index,widgetList[i][4]);void 0!==callback&&callback()},initBlankWidget=function(type,page,periode,intitule,callback,remoteDataCallback,haveDetail,index,favorisState){var tmp,currLi,IntitulesPages={infosFichiers:localisedString.HNLOC_DASH_MENU_FILEINFO_MAJ,stats:localisedString.HNLOC_DASH_MENU_STATS_MAJ,echosDuJour:localisedString.HNLOC_DASH_MENU_ECHOS_MAJ};if(""===page)if(index.length>0){tmp=$("#container > ul").append('<li class="mini"><div><span class="titre"></span></div></li>'),(currLi=$(tmp).find("li").last()).data("page",index[0]),currLi.data("index",index[1]),currLi.find(".titre").html(localisedString[intitule])}else{var SectionHeader='<li class="sectionHeader"><span>'+IntitulesPages[type]+"</span></li>";tmp=$("#container > ul").append(SectionHeader)}else"tabGen"===page?(tmp=$("#WidgetContainer").html('<div class="tabGeneration"></div>'),currLi=$(tmp),""!==remoteDataCallback&&($(currLi).find(".widget > .contenu ").append("<div>"),remoteDataCallback(cacheWidget,type,page,periode,intitule,idFile,port,callback,currLi))):(tmp=$("#WidgetContainer > ul").append(sqlte),currLi=$(tmp).find("li").last(),haveDetail?$(currLi).data("detail","true"):(eventHandler.hideDetailButton($(currLi)),$(currLi).data("detail","false")),page===localisedString.HNLOC_DASH_MENU_HOME&&$(currLi).find(".addToHomePage").hide(),favorisState?$(currLi).data("favoris","true"):$(currLi).data("favoris","false"),currLi.data("type",type),currLi.data("page",page),currLi.find(".details").html(localisedString.HNLOC_DASH_BUTTON_DETAIL_LABEL),currLi.find(".closeButton").attr("title",localisedString.HNLOC_DASH_BOUTON_FERMER),currLi.find(".Export").attr("title",localisedString.HNLOC_DASH_BUTTON_EXPORT),currLi.find(".entete > .titre").html(localisedString[intitule]),""!==remoteDataCallback&&($(currLi).find(".widget > .contenu ").append("<div>"),remoteDataCallback(cacheWidget,type,page,periode,intitule,idFile,port,callback,currLi)))};this.initOptions=function(callback){var window=$("#options");window.data("kendoWindow")||window.kendoWindow({width:"400px",minWidth:"400px",maxWidth:"400px",height:"300px",maxHeight:"300px",minHeight:"300px",title:localisedString.HNLOC_DASH_OPTIONS_LABEL,position:{top:"5%",left:"30%"},modal:!0,open:function(){$("#options").html(contenu),$("#options #periodLabel").html(localisedString.HNLOC_DASH_PERIODE_LABEL),$("#options #todayLabel").html(localisedString.HNLOC_DASH_PERIODE_TODAY_TITLE),$("#options #weekLabel").html(localisedString.HNLOC_DASH_PERIODE_WEEK_TITLE),$("#options #monthLabel").html(localisedString.HNLOC_DASH_PERIODE_MONTH_TITLE),$("#options #yearLabel").html(localisedString.HNLOC_DASH_PERIODE_YEAR_TITLE),$("#options #filterLabel").html(localisedString.HNLOC_DASH_FILTRE_LABEL),$("#options #allLabel").html(localisedString.HNLOC_DASH_FILTRE_ALL),$("#options #sosaLabel").html(localisedString.HNLOC_DASH_FILTRE_SOSA),$("#options #ascendancyLabel").html(localisedString.HNLOC_DASH_FILTRE_ASCENDANCE),$("#options #submitLabel").html(localisedString.HNLOC_DASH_OPTIONS_SUBMIT_LABEL),$("#options #defaultParameterLabel").html(localisedString.HNLOC_DASH_OPTIONS_DEFAULT_PARAMETER_LABEL),$("#options #defaultParameterLabel").attr("title",localisedString.HNLOC_DASH_OPTIONS_DEFAULT_PARAMETER_TOOLTIP),$("#options #helpLabel").html(localisedString.HNLOC_DASH_BUTTON_HELP_LABEL),$("#options").find("#filtreIndi").kendoDropDownList(),$("#options").find("#filtrePeriode").kendoDropDownList(),window.find(".openHelpPrefs").click(function(){loadHelpPage()}),callback(currentPortee,self.getPeriodeIntitule())}}).data("kendoWindow").center().open(),window.data("kendoWindow").open(),window.data("kendoWindow").center()}}