fsApiUtils.prototype.getDiscussion=function(did,callback,errorCallback){""===did||void 0===did?errorCallback():fsApiClient.get("/platform/discussions/discussions/"+did,function(error,Gdata){void 0!==callback&&callback(Gdata)})},fsApiUtils.prototype.getComments=function(did,callback,errorCallback){void 0===did?errorCallback():fsApiClient.get("/platform/discussions/discussions/"+did+"/comments",function(error,Gdata){void 0!==callback&&callback(Gdata)})},fsApiUtils.prototype.postComments=function(comment,did,callback,errorCallback){void 0===comment?errorCallback():fsApiClient.post("/platform/discussions/discussions/"+did+"/comments",{body:{discussions:[{id:did,comments:[{text:comment}]}]}},function(error,Gdata){void 0!==callback&&callback(Gdata)})},fsApiUtils.prototype.getAuthor=function(uid,callback,errorCallback){""===uid?errorCallback():fsApiClient.get("/platform/users/agents/"+uid,function(error,Gdata){void 0!==callback&&callback(Gdata)})},utils.prototype.getAllDiscussion=function(liste,disc,callback){var discussion=disc,compteur=0,fsApiCall=this.controller.getFsApiCall(),iteration=function(index){fsApiCall.getDiscussion(index,function(result){if(void 0!==result&&200===result.statusCode){var did=result.data.discussions[0].id,date=new Date(result.data.discussions[0].created),dateDisc="";if("1"===PREFERENCES.get("kPrefsOrdreDates")){var mois=date.getMonth()+1;dateDisc=date.getDate()+"/"+mois+"/"+date.getFullYear()}else dateDisc=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();for(var i=0;i<discussion.length;i++)discussion[i].id===did&&(index=i,uid=result.data.discussions[0].contributor.resourceId,discussion[i].author=uid,discussion[i].title=result.data.discussions[0].title,discussion[i].detail=result.data.discussions[0].details,discussion[i].date=dateDisc,fsApiCall.getAuthor(result.data.discussions[0].contributor.resourceId,function(data){discussion[index].author=data.data.agents[0].accounts[0].accountName,++compteur<nbr?iteration(liste[compteur].resourceId):void 0!==callback&&callback(discussion)}))}else void 0!==callback&&callback(discussion)})};if(0===nbr||void 0===liste)void 0!==callback&&callback(discussion);else{for(var nbr=liste.length,i=0;i<nbr;i++){disc={id:liste[i].resourceId};discussion.push(disc)}iteration(liste[compteur].resourceId)}},utils.prototype.getComs=function(did,disc,callback){var discussion=disc,index=0,indexCom=0,listeComs=null,fsApiCall=this.controller.getFsApiCall(),iteration=function(listeComs){var uid=listeComs[indexCom].contributor.resourceId,date=new Date(listeComs[indexCom].created),dateComs=null;if("1"===PREFERENCES.get("kPrefsOrdreDates")){var mois=date.getMonth()+1;dateComs=date.getDate()+"/"+mois+"/"+date.getFullYear()}else dateComs=date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear();comment={detail:listeComs[indexCom].text,author:uid,date:dateComs},discussion[index].comments.push(comment),indexCom=discussion[index].comments.length-1,fsApiCall.getAuthor(uid,function(data){discussion[index].comments[indexCom].author=data.data.agents[0].accounts[0].accountName,++indexCom<listeComs.length?iteration(listeComs):void 0!==callback&&callback(discussion)})};fsApiCall.getComments(did,function(resultat){if(200===resultat.statusCode)for(var did=resultat.data.discussions[0].id,i=0;i<discussion.length;i++)discussion[i].id===did&&(index=i,discussion[i].comments=[],discussion[i].numberOfComment=resultat.data.discussions[0].numberOfComments,0!==(listeComs=resultat.data.discussions[0].comments).length||void 0!==listeComs[indexCom]?iteration(listeComs):void 0!==callback&&callback(discussion));else void 0!==callback&&callback(discussion)})},viewUtils.prototype.displayDiscussionView=function(idContainer,callback){var discussion=[];kendo.ui.progress($("#discussion"),!0);var flag=!1;self.aux.getAllDiscussion(resp["discussion-references"],discussion,function(result){var getComments=function(did){self.aux.getComs(did,discussion,function(discussion){if(!1===flag)displayDiscussion(did),flag=!0;else for(var i=0;i<discussion.length;i++)discussion[i].id===did&&displayDiscussion(discussion[i],did,function(data){self.displayComments(data)})})},displayDiscussion=function(did){self.displayDiscussionsPage(function(){self.displayTitle(discussion,did,function(data){self.displayDiscussion(data,did,function(data){self.displayComments(data)})}),$("#close").addClass("buttonCompare").attr({"data-personid":$(e.target).data("personid")}).click(function(){var previousInfosForm=self.aux.getFormPreviousContent();self.aux.controller.initSearchForm(function(){self.aux.FillPCFieldCallback(previousInfosForm)})}),$("#discussionList li").click(function(){$(".select").removeClass("select"),$(this).addClass("select"),getComments($(this).attr("id"))}),$("#addComs").click(function(){""===$("#discussionView textarea").val()&&alert("veuillez remplir le champ")})})};if(result.length>0){var did=result[0].id;getComments(did)}else displayDiscussion()})},viewUtils.prototype.displayDiscussionsPage=function(callback){var self=this;this.controller.getViewManager();this.htmlTemplates.getHtmlFileTemplate("./html/discussions.html","#mainContent",function(){$("#title").html(self.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_TITLE),$("#titleOfList").html(self.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_TITLE_SECTION_TITLE),$("#titleOfDetail").html(self.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_DETAIL_SECTION_TITLE),$("#commentTitle").html(self.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_COMMENT_SECTION_TITLE),$("#close").html(self.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_CLOSE_BUTTON_LABEL),$("#addComs").html("ajouter un commentaire"),void 0!==callback&&callback()})},viewUtils.prototype.displayTitle=function(data,did,callback){var selec=null;if(data.length>0&&void 0!==data[0].id&&void 0!==data[0].title){$("#addComs").removeAttr("disabled");for(var i=0;i<data.length;i++){var li=$("<li/>").attr("id",data[i].id);$(li).append(data[i].title),data[i].id===did&&($(li).addClass("select"),selec=data[i]),$("#discussionList").append($(li))}void 0!==callback&&callback(selec)}else $("#discussionList").append($("<p/>").append(this.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_NO_CONTENT_DISCUSSION)),void 0!==callback&&callback()},viewUtils.prototype.displayDiscussion=function(data,did,callback){$(".detail").empty(),void 0!==data?($(".detail").append($("<p></p>").append(data.detail).addClass("col-xs-9")),$(".detail").append($("<p></p>").append(data.date).addClass("author col-xs-3")),$(".detail").append($("<p></p>").append(data.author).addClass("author col-xs-12")),void 0!==callback&&callback(data)):($(".detail").append($("<p></p>").append(this.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_NO_CONTENT_DISCUSSION)),void 0!==callback&&callback())},viewUtils.prototype.displayComments=function(data,callback){var heightComment=0;if($("#commentResult").empty(),void 0!==data&&data.numberOfComment>0){for(var i=data.comments.length-1;i>=0;i--){$("#commentResult").css({"overflow-y":"hidden"});var contener=$("<div/>").addClass("containerDetail"),detail=$("<div/>").addClass("detail"),author=$("<p/>").addClass("author").append(data.comments[i].author),com=$("<p/>").append(data.comments[i].detail),date=$("<p/>").append(data.comments[i].date);$(detail).append($(com).addClass("col-xs-9")),$(detail).append($(date).addClass("author col-xs-3")),$(detail).append($(author).addClass("col-xs-12")),$(contener).append($(detail)),$("#commentResult").append(contener),heightComment+=$(".containerDetail").outerHeight(!0),$("#commentResult").height()<=heightComment&&$("#commentResult").css({"overflow-y":"scroll"})}void 0!==callback&&callback()}else{contener=$("<div/>").addClass("containerDetail"),detail=$("<div/>").addClass("detail"),com=$("<p/>").append(this.stringsLocalised.HNLOC_FS_DISCUSSION_VIEW_NO_CONTENT_COMMENTS);$(detail).append($(com)),$(contener).append($(detail)),$("#commentResult").append(contener),void 0!==callback&&callback()}};