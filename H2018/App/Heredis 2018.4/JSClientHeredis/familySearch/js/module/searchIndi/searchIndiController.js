function searchIndiController(viewUtilsController){this.viewUtilsController=viewUtilsController,this.mainController=viewUtilsController.controller,this.stringsLocalised=viewUtilsController.stringsLocalised,this.aux=viewUtilsController.aux,this.searchIndiModele=new searchIndiModele(this)}searchIndiController.prototype.aux=null,searchIndiController.prototype.viewUtilsController=null,searchIndiController.prototype.mainController=null,searchIndiController.prototype.stringsLocalised=null,searchIndiController.prototype.searchFormModel=null,searchIndiController.prototype.searchResultModel=null,searchIndiController.prototype.searchIndiModele=null,searchIndiController.prototype.displaySearchView=function(idContainer,callback){var self=this,dataKendoDropDownList=[{text:self.stringsLocalised.HNLOC_FS_SEXE_MAN,value:109},{text:self.stringsLocalised.HNLOC_FS_SEXE_WOMAN,value:102},{text:self.stringsLocalised.HNLOC_FS_SEXE_UNDETERMINED,value:63}];self.viewUtilsController.htmlTemplates.getHtmlFileTemplate("./html/searchPage.html",idContainer,function(){var stateForm=self.aux.getStateForm(),stateFormLabel="";null===stateForm||""===stateForm?(self.AdvancedSearchFieldsHandler("less"),self.aux.saveStateForm("less"),stateFormLabel=self.stringsLocalised.HNLOC_FS_SEARCHFORM_FORM_PICKER_BUTTON_LABEL_MORE,stateForm=self.aux.getStateForm()):(self.AdvancedSearchFieldsHandler(stateForm),"more"===stateForm?stateFormLabel=self.stringsLocalised.HNLOC_FS_SEARCHFORM_FORM_PICKER_BUTTON_LABEL_LESS:"less"===stateForm&&(stateFormLabel=self.stringsLocalised.HNLOC_FS_SEARCHFORM_FORM_PICKER_BUTTON_LABEL_MORE)),self.searchFormModel=kendo.observable({isEnabled:!0,state:stateForm,parentsSectionText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_PARENTS,pcSectionText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_PC,spouseSectionText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_SPOUSE,surnameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_SURNAME,givenNameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_GIVENNAME,birthPlaceLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_BIRTHPLACE,deathPlaceLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_DEATHPLACE,birthDateLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_BIRTHDATE,deathDateLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_PLACEHOLDER_DEATHDATE,weddingDateLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_WEDDINGDATE,weddingPlaceLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_TEXT_WEDDINGPLACE,sexChoiceLabel:self.stringsLocalised.HNLOC_FS_SEXE_LABEL,fatherSurnameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_FATHER_NAME,fatherGivenNameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_FATHER_GIVENNAME,motherSurnameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_MOTHER_NAME,motherGivenNameLabel:self.stringsLocalised.HNLOC_FS_SEARCHFORM_LABEL_MOTHER_GIVENNAME,selectedSexe:63,dataSexeIndi:dataKendoDropDownList,onChangeDropDownList:function(){self.searchFormModel.set("isEnabled",!0),self.searchFormModel.set("selectedSexe",$("#sexChoice").data("kendoDropDownList").value())},ButtonFirstPageText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_MORE_RESULT_BUTTON_LABEL,ButtonFormPickerText:stateFormLabel,ButtonResetFormText:self.stringsLocalised.HNLOC_FS_FORM_RESET_BUTTON_LABEL,ButtonSearchText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_SEARCHBYPC_BUTTON_LABEL,ButtonSearchAction:function(){self.viewUtilsController.showLoadingText(""),this.set("isEnabled",!1),self.searchIndiModele.searchPC(),self.displaySearchViewResult("")},ButtonFormPickerAction:function(){"less"===this.get("state")?(self.aux.saveStateForm("more"),this.set("state","more"),this.set("ButtonFormPickerText",self.stringsLocalised.HNLOC_FS_SEARCHFORM_FORM_PICKER_BUTTON_LABEL_LESS)):"more"===this.get("state")&&(this.set("state","less"),self.aux.saveStateForm("less"),this.set("ButtonFormPickerText",self.stringsLocalised.HNLOC_FS_SEARCHFORM_FORM_PICKER_BUTTON_LABEL_MORE)),self.AdvancedSearchFieldsHandler(this.get("state")),this.set("isEnabled",!0)},ButtonResetFormAction:function(){self.resetSearchForm(),this.set("isEnabled",!0)},keypress:function(e){13===e.keyCode&&(self.viewUtilsController.showLoadingText(""),this.set("isEnabled",!1),self.searchIndiModele.searchPC(),self.displaySearchViewResult(""))}}),kendo.bind($(idContainer),self.searchFormModel),$("#sexChoice").kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:dataKendoDropDownList,change:function(){self.searchFormModel.set("isEnabled",!0)}}),$("#header .nav-tabs li").click(function(e){$("#header .nav-tabs li").each(function(){$(this).removeClass("active")}),$($(e.target).parent()).addClass("active")}),self.searchIndiModele.FillPCFieldCallback(null),void 0!==callback&&callback()})},searchIndiController.prototype.displaySearchViewResult=function(idContainer,callback){var self=this;self.viewUtilsController.htmlTemplates.getHtmlFileTemplate("./html/searchPageResult.html","#searchResults",function(){self.searchResultModel=kendo.observable({ButtonMoreResultText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_MORE_RESULT_BUTTON_LABEL,ButtonFirstPageText:self.stringsLocalised.HNLOC_FS_SEARCHFORM_TOP_BUTTON_LABEL,isMoreResultVisible:!1,isFooterVisible:!1,ButtonMoreResultAction:function(){self.viewUtilsController.showLoadingText(""),self.searchIndiModele.getMoreResults()}}),kendo.bind($("#results"),self.searchResultModel)})},searchIndiController.prototype.displayGrid=function(newSearch,data,contextId,indexData,totalRecords){this.handleNextPageResultSearch();var dataGrid=new Array;if(newSearch)dataGrid=data;else{dataSource=$("#searchResult").data("kendoGrid").dataSource;for(var i=0;i<data.length;i++)dataSource.add(data[i]);dataGrid=dataSource.data()}dataGrid.length;this.stringsLocalised.HNLOC_FS_TAB_HEADER_TOTAL_RESULT_LABEL,this.stringsLocalised.HNLOC_FS_TAB_2_POINT;void 0!==$("#"+contextId).data("kendoGrid")&&$("#"+contextId).data("kendoGrid").destroy();var grid=$("#"+contextId).kendoGrid({dataSource:{data:dataGrid},height:450,columns:[{title:" ",template:'<img style="width:15px;height:15px;display:block;margin:auto" src="#= gender #" >',field:"gender",width:40},{title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_SECTION_INDI_TITLE,columns:[{field:"name",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_LASTNAME_TITLE,minResizableWidth:40},{field:"personID",title:this.stringsLocalised.HNLOC_FS_SEARCHVIEW_GRID_FSID,minResizableWidth:40}]},{title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_SECTION_BIRTH_TITLE,columns:[{field:"birthDate",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_BIRTHDATE_TITLE,minResizableWidth:40},{field:"birthPlace",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_BIRTHPLACE_TITLE,minResizableWidth:40}]},{title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_SECTION_DEATH_TITLE,columns:[{field:"deathDate",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_DEATHDATE_TITLE,minResizableWidth:40},{field:"deathPlace",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_DEATHPLACE_TITLE,minResizableWidth:40}]},{field:"confidence",title:this.stringsLocalised.HNLOC_FS_TAB_RESULT_COLUMN_SCORE_TITLE,template:'<img src="../Common/Resources/score/star#= confidence #.png"/>',minResizableWidth:40,width:83},{title:" ",field:"compare",template:'<button style="display:none;margin:auto;padding:1px" data-personid="#= personID #" class="buttonCompare">'+this.stringsLocalised.HNLOC_FS_BUTTON_COMPARE+"</button>",width:65}],noRecords:!0,resizable:!0,selectable:!0,messages:{noRecords:this.stringsLocalised.HNLOC_FS_TAB_RESULT_NO_CONTENT}});void 0!==(grid=$("#"+contextId).data("kendoGrid"))&&grid.resizable.bind("start",function(e){"bar"!==$(e.currentTarget).data("th").data("field")&&"confidence"!==$(e.currentTarget).data("th").data("field")&&"gender"!==$(e.currentTarget).data("th").data("field")||(e.preventDefault(),setTimeout(function(){grid.wrapper.removeClass("k-grid-column-resizing"),$(document.body).add(".k-grid th").css("cursor","")}))}),$("#"+contextId+" tr").hover(function(){$(this).find(".buttonCompare").show()},function(){$("#"+contextId).find(".buttonCompare").hide()}),this.searchIndiModele.compareButtonSearchCallback(),this.bindActionOnRowClick("#"+contextId),this.viewUtilsController.disableLoadingText("")},searchIndiController.prototype.AdvancedSearchFieldsHandler=function(state){"less"===state?$("#containerPlusCriteres").hide():"more"===state&&$("#containerPlusCriteres").show()},searchIndiController.prototype.fillPCForm=function(c,dataPC,callback){var self=c;self.searchFormModel.set("surname",dataPC.surname),self.searchFormModel.set("givenName",dataPC.givenName),self.searchFormModel.set("birthPlace",dataPC.birthLikePlace),self.searchFormModel.set("birthDate",dataPC.birthLikeDate),self.searchFormModel.set("deathPlace",dataPC.deathLikePlace),self.searchFormModel.set("deathDate",dataPC.deathLikeDate),self.searchFormModel.set("fatherSurname",dataPC.fatherSurname),self.searchFormModel.set("fatherGivenName",dataPC.fatherGivenName),self.searchFormModel.set("motherSurname",dataPC.motherSurname),self.searchFormModel.set("motherGivenName",dataPC.motherGivenName),self.searchFormModel.set("weddingPlace",dataPC.marriagePlace),self.searchFormModel.set("weddingDate",dataPC.marriageDate),self.searchFormModel.set("spouseSurname",dataPC.spouseSurname),self.searchFormModel.set("spouseGivenName",dataPC.spouseGivenName),self.searchFormModel.set("selectedSexe",dataPC.sexe),$('.has-clear input[type="text"]').on("input propertychange",function(){var $this=$(this),visible=Boolean($this.val());$this.siblings(".form-control-clear").toggleClass("hidden",!visible),self.searchFormModel.set("isEnabled",!0)}).trigger("propertychange"),$(".form-control-clear").click(function(e){$(this).siblings('input[type="text"]').val("").trigger("propertychange").focus(),$(this).siblings('input[type="text"]').data("value",""),self.searchFormModel.set($(this).siblings('input[type="text"]').attr("id"),"")}),void 0!==callback&&callback()},searchIndiController.prototype.getInfosPCFromSearchForm=function(stateForm){var infosPC={};return"more"===stateForm?infosPC={surname:this.aux.checkArgForm(this.searchFormModel.get("surname")),givenName:this.aux.checkArgForm(this.searchFormModel.get("givenName")),birthLikeDate:this.aux.checkArgForm(this.searchFormModel.get("birthDate")),birthLikePlace:this.aux.checkArgForm(this.searchFormModel.get("birthPlace")),deathLikeDate:this.aux.checkArgForm(this.searchFormModel.get("deathDate")),deathLikePlace:this.aux.checkArgForm(this.searchFormModel.get("deathPlace")),fatherGivenName:this.aux.checkArgForm(this.searchFormModel.get("fatherGivenName")),fatherSurname:this.aux.checkArgForm(this.searchFormModel.get("fatherSurname")),motherGivenName:this.aux.checkArgForm(this.searchFormModel.get("motherGivenName")),motherSurname:this.aux.checkArgForm(this.searchFormModel.get("motherSurname")),spouseSurname:this.aux.checkArgForm(this.searchFormModel.get("spouseSurname")),spouseGivenName:this.aux.checkArgForm(this.searchFormModel.get("spouseGivenName")),marriageDate:this.aux.checkArgForm(this.searchFormModel.get("weddingDate")),marriagePlace:this.aux.checkArgForm(this.searchFormModel.get("weddingPlace")),sexe:this.aux.checkArgForm(this.searchFormModel.get("selectedSexe"))}:"less"===stateForm&&(infosPC={surname:this.aux.checkArgForm(this.searchFormModel.get("surname")),givenName:this.aux.checkArgForm(this.searchFormModel.get("givenName")),birthLikeDate:this.aux.checkArgForm(this.searchFormModel.get("birthDate")),birthLikePlace:this.aux.checkArgForm(this.searchFormModel.get("birthPlace")),deathLikeDate:this.aux.checkArgForm(this.searchFormModel.get("deathDate")),deathLikePlace:this.aux.checkArgForm(this.searchFormModel.get("deathPlace")),sexe:this.aux.checkArgForm(this.searchFormModel.get("selectedSexe"))}),infosPC},searchIndiController.prototype.handleNextPageResultSearch=function(){var self=this;void 0!==this.searchIndiModele.currentSearch&&void 0!==this.searchIndiModele.currentSearch.links.next?this.searchIndiModele.isNextPageSearchEmpty(function(isEmpty){isEmpty?(self.searchResultModel.set("isMoreResultVisible",!1),self.searchResultModel.set("isFooterVisible",!1),$("#searchResult").css("margin-bottom","0px")):isEmpty||(self.searchResultModel.set("isMoreResultVisible",!0),self.searchResultModel.set("isFooterVisible",!0),$("#searchResult").css("margin-bottom","32px"))}):(self.searchResultModel.set("isMoreResultVisible",!1),self.searchResultModel.set("isFooterVisible",!1))},searchIndiController.prototype.displaySearchResult=function(newSearch,results,indexPageResult,totalResults,callback){var persons=new Array;if(results.length>0)for(var i=0;i<results.length;i++){var indiFS=this.aux.getInfoIndi(results[i]);persons.push(indiFS)}this.displayGrid(newSearch,persons,"searchResult",indexPageResult,totalResults,callback)},searchIndiController.prototype.resetSearchForm=function(){var self=this;$("#searchFormPC input").val(""),$('.has-clear input[type="text"]').each(function(index){var $this=$(this);$this.siblings(".form-control-clear").toggleClass("hidden",!0),self.searchFormModel.set($this.attr("id"),"")}),$("#searchFormPC #sexChoice").data("kendoDropDownList").text(this.viewUtilsController.mapSexeStringsIndi[63]),$("#searchFormPC #sexChoice").data("kendoDropDownList").value(63),self.searchFormModel.set("selectedSexe",63)},searchIndiController.prototype.alertErrorCallbackForm=function(){alert(this.stringsLocalised.HNLOC_FS_DEFAULT_MSG_NO_CRITERIA),kendo.ui.progress($("#searchResult"),!1)},searchIndiController.prototype.bindActionOnRowClick=function(contextId){var grid=$(contextId).data("kendoGrid"),self=this;void 0!==grid&&(grid.unbind("change"),grid.bind("change",function(e){var selectedCell=this.select(),name=this.dataItem(selectedCell).name,personID=this.dataItem(selectedCell).personID;self.searchIndiModele.callbackClickRow(personID,name)}))},searchIndiController.prototype.internalServerErrorForm=function(errorCode,pid){400===errorCode?this.alertErrorCallbackForm():this.viewUtilsController.ErrorRequestHandler(errorCode,pid),this.searchFormModel.set("isEnabled",!0),this.viewUtilsController.disableLoadingText("")},searchIndiController.prototype.reloadView=function(){$("#searchFormFields").empty(),this.viewUtilsController.hideFullScreenModal()};