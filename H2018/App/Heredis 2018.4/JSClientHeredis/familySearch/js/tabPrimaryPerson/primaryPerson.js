function primaryPersonController(viewUtilsController){mainTabController.call(this,viewUtilsController),this.mainController=viewUtilsController.controller,this.fsApi=controller.getFsApiCall(),this.heredisApi=controller.getHeredisApiCall(),this.stringsLocalised=viewUtilsController.stringsLocalised,this.searchController=new searchIndiController(viewUtilsController),this.compareIndiController=new compareIndiController(viewUtilsController)}primaryPersonController.prototype.viewUtilsController=null,primaryPersonController.prototype.mainController=null,primaryPersonController.prototype.fsApi=null,primaryPersonController.prototype.heredisApi=null,primaryPersonController.prototype.stringsLocalised=null,primaryPersonController.prototype.searchController=null,primaryPersonController.prototype.compareIndiController=null,primaryPersonController.prototype.indiFS=null,primaryPersonController.prototype.indiHeredis=null,primaryPersonController.prototype.statusCode="",primaryPersonController.prototype.pcFormModel=null,primaryPersonController.prototype.displayPrimaryPersonView=function(callback){if(this.shouldReload){var self=this;self.loadInfosPc(function(){var strLinked,strIdentityPc=self.indiHeredis.tabPcFullIdentity,strDatesPc=self.indiHeredis.tabPcDates;if(""!=self.statusCode)strLinked=self.stringsLocalised.HNLOC_FS_PC_LINKED_DELETED;else if(""==self.indiHeredis.fsid)strLinked=self.stringsLocalised.HNLOC_FS_PC_NOT_LINKED;else{var strIndiFs=self.indiFS.display.name+" - "+self.indiHeredis.fsid;strLinked=self.stringsLocalised.HNLOC_FS_PC_LINKED_TO.replace("%s",strIndiFs)}self.viewUtilsController.htmlTemplates.getHtmlFileTemplate("./html/primaryPerson.html","#tabPcMainForm",function(){$("#part1").css("min-height","550px"),self.pcFormModel=kendo.observable({pcInfosIdentity:strIdentityPc,pcInfosDates:strDatesPc,pcLinkedToFS:strLinked,tabPcLabelTemple:self.stringsLocalised.HNLOC_FS_LABEL_TEMPLE,tabPcBtnBaptism:self.stringsLocalised.HNLOC_FS_BTN_BAPTISM,tabPcBtnConfirmation:self.stringsLocalised.HNLOC_FS_BTN_CONFIRMATION,tabPcBtnInitiatory:self.stringsLocalised.HNLOC_FS_BTN_INITIATORY,tabPcBtnEndowment:self.stringsLocalised.HNLOC_FS_BTN_ENDOWMENT,tabPcBtnSealingParents:self.stringsLocalised.HNLOC_FS_BTN_SEALING_PARENTS,tabPcBtnSealingSpouse:self.stringsLocalised.HNLOC_FS_BTN_SEALING_SPOUSE}),kendo.bind($("#tabPcMainForm"),self.pcFormModel),void 0!==callback&&callback(),self.showHideContainers(),self.shouldReload=!1})})}else callback()},primaryPersonController.prototype.loadInfosPc=function(callback){var self=this;self.viewUtilsController.aux.getPC(self,function(infoPC){if(self.indiHeredis=infoPC,""!==infoPC.fsid){pid=infoPC.fsid,self.fsApi.getPersonById(pid,function(aBool,data){self.statusCode="",self.indiFS=data,callback()},function(error){self.statusCode=error,self.indiFS={id:pid},callback("")})}else self.statusCode="",callback("");var pid})},primaryPersonController.prototype.showHideContainers=function(){""!=this.statusCode?(console.log("status code : "+this.statusCode),$("#tabPcActionButtonsContainer").hide(),this.displayTreeCompare()):""!=this.indiHeredis.fsid?($("#tabPcActionButtonsContainer").hide(),this.loadOrdinances(),this.displayTreeCompare()):($("#tabPcActionButtonsContainer").hide(),this.displaySearchView())},primaryPersonController.prototype.loadOrdinances=function(){var self=this;self.fsApi.canReadOrdinances().then(function(data){return console.log(data),self.fsApi.readOrdinances(self.indiHeredis.fsid)}).then(function(data){var ordinanceClasses=function(data,ordinanceDivId){console.log(data);var tmp="",fsStatus=data.status;tmp="http://familysearch.org/v1/Ready"===fsStatus?"tabPCOrdinanceReady":"http://familysearch.org/v1/Reserved"===fsStatus?data.hasOwnProperty("assignee")?"tabPCOrdinanceSharedNotPrinted":"tabPCOrdinanceNotPrinted":"http://familysearch.org/v1/InProgress"===fsStatus?data.hasOwnProperty("assignee")?"tabPCOrdinanceSharedPrinted":"tabPCOrdinancePrinted":"http://familysearch.org/v1/Completed"===fsStatus?"tabPCOrdinanceCompleted":"http://familysearch.org/v1/NeedMoreInformation"===fsStatus?"tabPCOrdinanceNotAvailable":"http://familysearch.org/v1/NotNeeded"===fsStatus?"tabPCOrdinanceNotNeeded":"tabPCOrdinanceNotAvailable",$("#"+ordinanceDivId).removeClass().addClass("tabPCOrdinanceIcon "+tmp),self.loadTooltip(data,ordinanceDivId)};$("#tabPcActionButtonsContainer").show(),ordinanceClasses(data["http://lds.org/Baptism"],"tabPcOrdinanceBaptism"),ordinanceClasses(data["http://lds.org/Confirmation"],"tabPcOrdinanceConfirmation"),ordinanceClasses(data["http://lds.org/Initiatory"],"tabPcOrdinanceInitiatory"),ordinanceClasses(data["http://lds.org/Endowment"],"tabPcOrdinanceEndowment");var tmp=void 0!==data["http://lds.org/SealingChildToParents"]?data["http://lds.org/SealingChildToParents"]:{};ordinanceClasses(tmp,"tabPcOrdinanceSealingParents"),ordinanceClasses(tmp=void 0!==data["http://lds.org/SealingToSpouse"]?data["http://lds.org/SealingToSpouse"]:{},"tabPcOrdinanceSealingSpouse"),console.log(data)}).catch(function(error){console.log(error)})},primaryPersonController.prototype.loadTooltip=function(data,ordinanceDivId){var self=this;console.log(data);!function(callback){var fsStatus=data.status;if("http://familysearch.org/v1/Ready"===fsStatus)callback(self.stringsLocalised.HNLOC_FS_ORDINANCE_READY);else if("http://familysearch.org/v1/Reserved"===fsStatus||"http://familysearch.org/v1/InProgress"===fsStatus){var agentPid=data.attribution.contributor.resourceId;console.log("agentPid = "+agentPid),self.fsApi.getAgent(agentPid).then(function(agentObj){var userName=agentObj.agents[0].accounts[0].accountName;"http://familysearch.org/v1/InProgress"===fsStatus?data.hasOwnProperty("assignee")?tmpStr=self.stringsLocalised.HNLOC_FS_ORDINANCE_PRINTED_SHARED:tmpStr=self.stringsLocalised.HNLOC_FS_ORDINANCE_PRINTED:data.hasOwnProperty("assignee")?tmpStr=self.stringsLocalised.HNLOC_FS_ORDINANCE_NOT_PRINTED_SHARED:tmpStr=self.stringsLocalised.HNLOC_FS_ORDINANCE_NOT_PRINTED,callback(tmpStr.replace("%user",userName))})}else"http://familysearch.org/v1/Completed"===fsStatus?self.heredisApi.formatJSON(encodeURIComponent(JSON.stringify(data)),function(dataResp){callback(self.stringsLocalised.HNLOC_FS_ORDINANCE_COMPLETED.replace("%date",dataResp.date["heredis-formalDate"]))}):"http://familysearch.org/v1/NeedMoreInformation"===fsStatus?"tabPcOrdinanceSealingParents"===ordinanceDivId?data.hasOwnProperty("father")&&data.hasOwnProperty("mother")?callback(self.stringsLocalised.HNLOC_FS_ORDINANCE_INFO_NEEDED):callback(self.stringsLocalised.HNLOC_FS_ORDINANCE_INFO_NEEDED_PARENTS):callback(self.stringsLocalised.HNLOC_FS_ORDINANCE_INFO_NEEDED):callback("http://familysearch.org/v1/NotNeeded"===fsStatus?"":self.stringsLocalised.HNLOC_FS_ORDINANCE_NOT_AVAILABLE)}(function(tmpStr){var strTypeOrdonnance="";"tabPcOrdinanceBaptism"===ordinanceDivId?strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_BAPTISM:"tabPcOrdinanceConfirmation"===ordinanceDivId?strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_CONFIRMATION:"tabPcOrdinanceInitiatory"===ordinanceDivId?strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_INITIATORY:"tabPcOrdinanceEndowment"===ordinanceDivId?strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_ENDOWMENT:"tabPcOrdinanceSealingParents"===ordinanceDivId?strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_SEALING_PARENTS:"tabPcOrdinanceSealingSpouse"===ordinanceDivId&&(strTypeOrdonnance=self.stringsLocalised.HNLOC_FS_ORDINANCE_SEALING_SPOUSE);var toolTipStr=self.stringsLocalised.HNLOC_FS_ORDINANCE_TOOLTIP.replace("%ordi",strTypeOrdonnance).replace("%status",tmpStr);$("#"+ordinanceDivId).attr("title",toolTipStr)})},primaryPersonController.prototype.displaySearchView=function(callback){if(this.shouldReload){var self=this;this.searchController.displaySearchView("#tabPcLowerContainer",function(){self.shouldReload=!1,$("#tabPcLowerContainer").css({padding:"0px  "}),void 0!==callback&&callback()})}else void 0!==callback&&callback()},primaryPersonController.prototype.displayCompareView=function(fsIndi,heredisIndi,callback){},primaryPersonController.prototype.displayTreeCompare=function(callback){var self=this;self.viewUtilsController.aux.compareIndiModele=new compareIndiModele(self.viewUtilsController.aux,self.fsApi,self.heredisApi),self.viewUtilsController.aux.compareIndiModele.getFamilyOfIndiFs(self.indiFS.id,"",function(heredisTreePerson,fsTreePersons){var heredisFamilytree,fsFamilyTree;heredisFamilytree=heredisTreePerson,fsFamilyTree=fsTreePersons,self.compareIndiController.displayCompareIndiTreeView(fsFamilyTree,heredisFamilytree,"tabPcLowerContainer"),$("#tabPcLowerContainer").css({padding:"0px 6px 0px 6px"})})},primaryPersonController.prototype.reloadViewAfterLink=function(){this.searchController.reloadView()};